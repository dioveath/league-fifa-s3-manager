/*! For license information please see manager.js.LICENSE.txt */
(()=>{var t={676:function(t,e){!function(t){"use strict";function e(t){return Array.prototype.slice.call(t)}function n(t){return new Promise((function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function i(t,e,i){var s,r=new Promise((function(r,o){n(s=t[e].apply(t,i)).then(r,o)}));return r.request=s,r}function s(t,e,n){var s=i(t,e,n);return s.then((function(t){if(t)return new u(t,s.request)}))}function r(t,e,n){n.forEach((function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})}))}function o(t,e,n,s){s.forEach((function(s){s in n.prototype&&(t.prototype[s]=function(){return i(this[e],s,arguments)})}))}function a(t,e,n,i){i.forEach((function(i){i in n.prototype&&(t.prototype[i]=function(){return this[e][i].apply(this[e],arguments)})}))}function c(t,e,n,i){i.forEach((function(i){i in n.prototype&&(t.prototype[i]=function(){return s(this[e],i,arguments)})}))}function h(t){this._index=t}function u(t,e){this._cursor=t,this._request=e}function l(t){this._store=t}function d(t){this._tx=t,this.complete=new Promise((function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}}))}function f(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new d(n)}function p(t){this._db=t}r(h,"_index",["name","keyPath","multiEntry","unique"]),o(h,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),c(h,"_index",IDBIndex,["openCursor","openKeyCursor"]),r(u,"_cursor",["direction","key","primaryKey","value"]),o(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach((function(t){t in IDBCursor.prototype&&(u.prototype[t]=function(){var e=this,i=arguments;return Promise.resolve().then((function(){return e._cursor[t].apply(e._cursor,i),n(e._request).then((function(t){if(t)return new u(t,e._request)}))}))})})),l.prototype.createIndex=function(){return new h(this._store.createIndex.apply(this._store,arguments))},l.prototype.index=function(){return new h(this._store.index.apply(this._store,arguments))},r(l,"_store",["name","keyPath","indexNames","autoIncrement"]),o(l,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),c(l,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),a(l,"_store",IDBObjectStore,["deleteIndex"]),d.prototype.objectStore=function(){return new l(this._tx.objectStore.apply(this._tx,arguments))},r(d,"_tx",["objectStoreNames","mode"]),a(d,"_tx",IDBTransaction,["abort"]),f.prototype.createObjectStore=function(){return new l(this._db.createObjectStore.apply(this._db,arguments))},r(f,"_db",["name","version","objectStoreNames"]),a(f,"_db",IDBDatabase,["deleteObjectStore","close"]),p.prototype.transaction=function(){return new d(this._db.transaction.apply(this._db,arguments))},r(p,"_db",["name","version","objectStoreNames"]),a(p,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach((function(t){[l,h].forEach((function(n){t in n.prototype&&(n.prototype[t.replace("open","iterate")]=function(){var n=e(arguments),i=n[n.length-1],s=this._store||this._index,r=s[t].apply(s,n.slice(0,-1));r.onsuccess=function(){i(r.result)}})}))})),[h,l].forEach((function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,i=[];return new Promise((function(s){n.iterateCursor(t,(function(t){t?(i.push(t.value),void 0===e||i.length!=e?t.continue():s(i)):s(i)}))}))})})),t.openDb=function(t,e,n){var s=i(indexedDB,"open",[t,e]),r=s.request;return r&&(r.onupgradeneeded=function(t){n&&n(new f(r.result,t.oldVersion,r.transaction))}),s.then((function(t){return new p(t)}))},t.deleteDb=function(t){return i(indexedDB,"deleteDatabase",[t])},Object.defineProperty(t,"__esModule",{value:!0})}(e)}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var r=e[i]={exports:{}};return t[i].call(r.exports,r,r.exports,n),r.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";class t{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function e(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function i(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}class s extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,s.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,r.prototype.create)}}class r{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,r=this.errors[t],a=r?function(t,e){return t.replace(o,((t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",c=`${this.serviceName}: ${a} (${i}).`;return new s(i,c,n)}}const o=/\{\$([^}]+)}/g;function a(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const s of n){if(!i.includes(s))return!1;const n=t[s],r=e[s];if(c(n)&&c(r)){if(!a(n,r))return!1}else if(n!==r)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function c(t){return null!==t&&"object"==typeof t}function h(t,e=1e3,n=2){const i=e*Math.pow(n,t),s=Math.round(.5*i*(Math.random()-.5)*2);return Math.min(144e5,i+s)}function u(t){return t&&t._delegate?t._delegate:t}class l{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const d="[DEFAULT]";class f{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const e=new t;if(this.instancesDeferred.set(n,e),this.isInitialized(n)||this.shouldAutoInitialize())try{const t=this.getOrInitializeService({instanceIdentifier:n});t&&e.resolve(t)}catch(t){}}return this.instancesDeferred.get(n).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(i)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:d})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t="[DEFAULT]"){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t="[DEFAULT]"){return this.instances.has(t)}getOptions(t="[DEFAULT]"){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(i);return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&t(r,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===d?void 0:i),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var i;return n||null}normalizeInstanceIdentifier(t="[DEFAULT]"){return this.component?this.component.multipleInstances?t:d:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class p{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new f(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const g=[];var m,y;(y=m||(m={}))[y.DEBUG=0]="DEBUG",y[y.VERBOSE=1]="VERBOSE",y[y.INFO=2]="INFO",y[y.WARN=3]="WARN",y[y.ERROR=4]="ERROR",y[y.SILENT=5]="SILENT";const v={debug:m.DEBUG,verbose:m.VERBOSE,info:m.INFO,warn:m.WARN,error:m.ERROR,silent:m.SILENT},w=m.INFO,E={[m.DEBUG]:"log",[m.VERBOSE]:"log",[m.INFO]:"info",[m.WARN]:"warn",[m.ERROR]:"error"},b=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),s=E[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${i}]  ${t.name}:`,...n)};class T{constructor(t){this.name=t,this._logLevel=w,this._logHandler=b,this._userLogHandler=null,g.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in m))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?v[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,m.DEBUG,...t),this._logHandler(this,m.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,m.VERBOSE,...t),this._logHandler(this,m.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,m.INFO,...t),this._logHandler(this,m.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,m.WARN,...t),this._logHandler(this,m.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,m.ERROR,...t),this._logHandler(this,m.ERROR,...t)}}class I{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const S="@firebase/app",A="0.7.11",C=new T("@firebase/app"),D={[S]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},k=new Map,_=new Map;function N(t,e){try{t.container.addComponent(e)}catch(n){C.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function R(t){const e=t.name;if(_.has(e))return C.debug(`There were multiple attempts to register component ${e}.`),!1;_.set(e,t);for(const e of k.values())N(e,t);return!0}function L(t,e){return t.container.getProvider(e)}const x=new r("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class O{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new l("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw x.create("app-deleted",{appName:this._name})}}function M(t="[DEFAULT]"){const e=k.get(t);if(!e)throw x.create("no-app",{appName:t});return e}function P(t,e,n){var i;let s=null!==(i=D[t])&&void 0!==i?i:t;n&&(s+=`-${n}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${s}" with version "${e}":`];return r&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void C.warn(t.join(" "))}R(new l(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}R(new l("platform-logger",(t=>new I(t)),"PRIVATE")),P(S,A,""),P(S,A,"esm2017"),P("fire-js",""),P("firebase","9.6.1","app");var F=n(676);const V="@firebase/installations",U="0.5.4",j="w:0.5.4",q=new r("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function B(t){return t instanceof s&&t.code.includes("request-failed")}function $({projectId:t}){return`https://firebaseinstallations.googleapis.com/v1/projects/${t}/installations`}function K(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function H(t,e){const n=(await e.json()).error;return q.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function z({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function G(t){const e=await t();return e.status>=500&&e.status<600?t():e}function W(t){return new Promise((e=>{setTimeout(e,t)}))}const Q=/^[cdef][\w-]{21}$/;function X(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var e}(t);return Q.test(e)?e:""}catch(t){return""}}function Y(t){return`${t.appName}!${t.appId}`}const J=new Map;function Z(t,e){const n=Y(t);tt(n,e),function(t,e){const n=(!et&&"BroadcastChannel"in self&&(et=new BroadcastChannel("[Firebase] FID Change"),et.onmessage=t=>{tt(t.data.key,t.data.fid)}),et);n&&n.postMessage({key:t,fid:e}),0===J.size&&et&&(et.close(),et=null)}(n,e)}function tt(t,e){const n=J.get(t);if(n)for(const t of n)t(e)}let et=null;const nt="firebase-installations-store";let it=null;function st(){return it||(it=(0,F.openDb)("firebase-installations-database",1,(t=>{0===t.oldVersion&&t.createObjectStore(nt)}))),it}async function rt(t,e){const n=Y(t),i=(await st()).transaction(nt,"readwrite"),s=i.objectStore(nt),r=await s.get(n);return await s.put(e,n),await i.complete,r&&r.fid===e.fid||Z(t,e.fid),e}async function ot(t){const e=Y(t),n=(await st()).transaction(nt,"readwrite");await n.objectStore(nt).delete(e),await n.complete}async function at(t,e){const n=Y(t),i=(await st()).transaction(nt,"readwrite"),s=i.objectStore(nt),r=await s.get(n),o=e(r);return void 0===o?await s.delete(n):await s.put(o,n),await i.complete,!o||r&&r.fid===o.fid||Z(t,o.fid),o}async function ct(t){let e;const n=await at(t,(n=>{const i=function(t){return lt(t||{fid:X(),registrationStatus:0})}(n),s=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(q.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(t,e){try{const n=await async function(t,{fid:e}){const n=$(t),i=z(t),s={fid:e,authVersion:"FIS_v2",appId:t.appId,sdkVersion:j},r={method:"POST",headers:i,body:JSON.stringify(s)},o=await G((()=>fetch(n,r)));if(o.ok){const t=await o.json();return{fid:t.fid||e,registrationStatus:2,refreshToken:t.refreshToken,authToken:K(t.authToken)}}throw await H("Create Installation",o)}(t,e);return rt(t,n)}catch(n){throw B(n)&&409===n.customData.serverCode?await ot(t):await rt(t,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:i}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:ht(t)}:{installationEntry:e}}(t,i);return e=s.registrationPromise,s.installationEntry}));return""===n.fid?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function ht(t){let e=await ut(t);for(;1===e.registrationStatus;)await W(100),e=await ut(t);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await ct(t);return n||e}return e}function ut(t){return at(t,(t=>{if(!t)throw q.create("installation-not-found");return lt(t)}))}function lt(t){return 1===(e=t).registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function dt({appConfig:t,platformLoggerProvider:e},n){const i=function(t,{fid:e}){return`${$(t)}/${e}/authTokens:generate`}(t,n),s=function(t,{refreshToken:e}){const n=z(t);return n.append("Authorization",function(t){return`FIS_v2 ${t}`}(e)),n}(t,n),r=e.getImmediate({optional:!0});r&&s.append("x-firebase-client",r.getPlatformInfoString());const o={installation:{sdkVersion:j}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await G((()=>fetch(i,a)));if(c.ok)return K(await c.json());throw await H("Generate Auth Token",c)}async function ft(t,e=!1){let n;const i=await at(t.appConfig,(i=>{if(!gt(i))throw q.create("not-registered");const s=i.authToken;if(!e&&(2===(r=s).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+36e5}(r)))return i;var r;if(1===s.requestStatus)return n=async function(t,e){let n=await pt(t.appConfig);for(;1===n.authToken.requestStatus;)await W(100),n=await pt(t.appConfig);const i=n.authToken;return 0===i.requestStatus?ft(t,e):i}(t,e),i;{if(!navigator.onLine)throw q.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(i);return n=async function(t,e){try{const n=await dt(t,e),i=Object.assign(Object.assign({},e),{authToken:n});return await rt(t.appConfig,i),n}catch(n){if(!B(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await rt(t.appConfig,n)}else await ot(t.appConfig);throw n}}(t,e),e}}));return n?await n:i.authToken}function pt(t){return at(t,(t=>{if(!gt(t))throw q.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+1e4<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function gt(t){return void 0!==t&&2===t.registrationStatus}function mt(t){return q.create("missing-app-config-values",{valueName:t})}const yt="installations";R(new l(yt,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw mt("App Configuration");if(!t.name)throw mt("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw mt(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,platformLoggerProvider:L(e,"platform-logger"),_delete:()=>Promise.resolve()}}),"PUBLIC")),R(new l("installations-internal",(t=>{const e=L(t.getProvider("app").getImmediate(),yt).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:i}=await ct(e.appConfig);return i?i.catch(console.error):ft(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await ct(t);e&&await e}(n.appConfig),(await ft(n,e)).token}(e,t)}}),"PRIVATE")),P(V,U),P(V,U,"esm2017");const vt="analytics",wt="https://www.googletagmanager.com/gtag/js",Et=new T("@firebase/analytics");function bt(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const Tt=new r("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),It=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function St(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function At(t,e=It,n){const{appId:i,apiKey:s,measurementId:r}=t.options;if(!i)throw Tt.create("no-app-id");if(!s){if(r)return{measurementId:r,appId:i};throw Tt.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Dt;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),Ct({appId:i,apiKey:s,measurementId:r},o,a,e)}async function Ct(t,{throttleEndTimeMillis:e,backoffCount:n},i,r=It){const{appId:o,measurementId:a}=t;try{await function(t,e){return new Promise(((n,i)=>{const s=Math.max(e-Date.now(),0),r=setTimeout(n,s);t.addEventListener((()=>{clearTimeout(r),i(Tt.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(i,e)}catch(t){if(a)return Et.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${t.message}]`),{appId:o,measurementId:a};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:i}=t,s={method:"GET",headers:St(i)},r="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(r,s);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw Tt.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return r.deleteThrottleMetadata(o),e}catch(e){if(!function(t){if(!(t instanceof s&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(e)){if(r.deleteThrottleMetadata(o),a)return Et.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${e.message}]`),{appId:o,measurementId:a};throw e}const c=503===Number(e.customData.httpStatus)?h(n,r.intervalMillis,30):h(n,r.intervalMillis),u={throttleEndTimeMillis:Date.now()+c,backoffCount:n+1};return r.setThrottleMetadata(o,u),Et.debug(`Calling attemptFetch again in ${c} millis`),Ct(t,u,i,r)}}class Dt{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}async function kt(t,e,n,i,s,r,o){var a;const c=At(t);c.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Et.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>Et.error(t))),e.push(c);const h=async function(){if("object"!=typeof indexedDB)return Et.warn(Tt.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await new Promise(((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}catch(t){return Et.warn(Tt.create("indexeddb-unavailable",{errorInfo:t}).message),!1}return!0}().then((t=>t?i.getId():void 0)),[u,l]=await Promise.all([c,h]);(function(){const t=window.document.getElementsByTagName("script");for(const e of Object.values(t))if(e.src&&e.src.includes(wt))return e;return null})()||function(t,e){const n=document.createElement("script");n.src=`${wt}?l=${t}&id=${e}`,n.async=!0,document.head.appendChild(n)}(r,u.measurementId),s("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d.origin="firebase",d.update=!0,null!=l&&(d.firebase_id=l),s("config",u.measurementId,d),u.measurementId}class _t{constructor(t){this.app=t}_delete(){return delete Nt[this.app.options.appId],Promise.resolve()}}let Nt={},Rt=[];const Lt={};let xt,Ot,Mt="dataLayer",Pt=!1;function Ft(t,e,n){!function(){const t=[];if(i()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=Tt.create("invalid-analytics-context",{errorInfo:e});Et.warn(n.message)}}();const s=t.options.appId;if(!s)throw Tt.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw Tt.create("no-api-key");Et.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Nt[s])throw Tt.create("already-exists",{id:s});if(!Pt){!function(t){let e=[];Array.isArray(window.dataLayer)?e=window.dataLayer:window.dataLayer=e}();const{wrappedGtag:t,gtagCore:e}=function(t,e,n,i,s){let r=function(...t){window.dataLayer.push(arguments)};return window.gtag&&"function"==typeof window.gtag&&(r=window.gtag),window.gtag=function(t,e,n,i){return async function(s,r,o){try{"event"===s?await async function(t,e,n,i,s){try{let r=[];if(s&&s.send_to){let t=s.send_to;Array.isArray(t)||(t=[t]);const i=await bt(n);for(const n of t){const t=i.find((t=>t.measurementId===n)),s=t&&e[t.appId];if(!s){r=[];break}r.push(s)}}0===r.length&&(r=Object.values(e)),await Promise.all(r),t("event",i,s||{})}catch(t){Et.error(t)}}(t,e,n,r,o):"config"===s?await async function(t,e,n,i,s,r){const o=i[s];try{if(o)await e[o];else{const t=(await bt(n)).find((t=>t.measurementId===s));t&&await e[t.appId]}}catch(t){Et.error(t)}t("config",s,r)}(t,e,n,i,r,o):t("set",r)}catch(t){Et.error(t)}}}(r,t,e,n),{gtagCore:r,wrappedGtag:window.gtag}}(Nt,Rt,Lt);Ot=t,xt=e,Pt=!0}return Nt[s]=kt(t,Rt,Lt,e,xt,Mt,n),new _t(t)}const Vt="@firebase/analytics",Ut="0.7.4";R(new l(vt,((t,{options:e})=>Ft(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),R(new l("analytics-internal",(function(t){try{const e=t.getProvider(vt).getImmediate();return{logEvent:(t,n,i)=>function(t,e,n,i){t=u(t),async function(t,e,n,i,s){if(s&&s.global)t("event",n,i);else{const s=await e;t("event",n,Object.assign(Object.assign({},i),{send_to:s}))}}(Ot,Nt[t.app.options.appId],e,n,i).catch((t=>Et.error(t)))}(e,t,n,i)}}catch(t){throw Tt.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),P(Vt,Ut),P(Vt,Ut,"esm2017");var jt,qt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},Bt={},$t=$t||{},Kt=qt||self;function Ht(){}function zt(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function Gt(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Wt="closure_uid_"+(1e9*Math.random()>>>0),Qt=0;function Xt(t,e,n){return t.call.apply(t.bind,arguments)}function Yt(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Jt(t,e,n){return(Jt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Xt:Yt).apply(null,arguments)}function Zt(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function te(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return e.prototype[n].apply(t,s)}}function ee(){this.s=this.s,this.o=this.o}var ne={};ee.prototype.s=!1,ee.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,Wt)&&t[Wt]||(t[Wt]=++Qt)}(this);delete ne[t]}},ee.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ie=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},se=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){const i=t.length,s="string"==typeof t?t.split(""):t;for(let r=0;r<i;r++)r in s&&e.call(n,s[r],r,t)};function re(t){return Array.prototype.concat.apply([],arguments)}function oe(t){const e=t.length;if(0<e){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function ae(t){return/^[\s\xa0]*$/.test(t)}var ce,he=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function ue(t,e){return-1!=t.indexOf(e)}function le(t,e){return t<e?-1:t>e?1:0}t:{var de=Kt.navigator;if(de){var fe=de.userAgent;if(fe){ce=fe;break t}}ce=""}function pe(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function ge(t){const e={};for(const n in t)e[n]=t[n];return e}var me="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ye(t,e){let n,i;for(let e=1;e<arguments.length;e++){for(n in i=arguments[e],i)t[n]=i[n];for(let e=0;e<me.length;e++)n=me[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function ve(t){return ve[" "](t),t}ve[" "]=Ht;var we,Ee,be=ue(ce,"Opera"),Te=ue(ce,"Trident")||ue(ce,"MSIE"),Ie=ue(ce,"Edge"),Se=Ie||Te,Ae=ue(ce,"Gecko")&&!(ue(ce.toLowerCase(),"webkit")&&!ue(ce,"Edge"))&&!(ue(ce,"Trident")||ue(ce,"MSIE"))&&!ue(ce,"Edge"),Ce=ue(ce.toLowerCase(),"webkit")&&!ue(ce,"Edge");function De(){var t=Kt.document;return t?t.documentMode:void 0}t:{var ke="",_e=(Ee=ce,Ae?/rv:([^\);]+)(\)|;)/.exec(Ee):Ie?/Edge\/([\d\.]+)/.exec(Ee):Te?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Ee):Ce?/WebKit\/(\S+)/.exec(Ee):be?/(?:Version)[ \/]?(\S+)/.exec(Ee):void 0);if(_e&&(ke=_e?_e[1]:""),Te){var Ne=De();if(null!=Ne&&Ne>parseFloat(ke)){we=String(Ne);break t}}we=ke}var Re,Le={};function xe(){return t=Le,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){let t=0;const e=he(String(we)).split("."),n=he("9").split("."),i=Math.max(e.length,n.length);for(let o=0;0==t&&o<i;o++){var s=e[o]||"",r=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==s[0].length&&0==r[0].length)break;t=le(0==s[1].length?0:parseInt(s[1],10),0==r[1].length?0:parseInt(r[1],10))||le(0==s[2].length,0==r[2].length)||le(s[2],r[2]),s=s[3],r=r[3]}while(0==t)}return 0<=t}();var t}Kt.document&&Te?Re=De()||parseInt(we,10)||void 0:Re=void 0;var Oe=Re,Me=function(){if(!Kt.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Kt.addEventListener("test",Ht,e),Kt.removeEventListener("test",Ht,e)}catch(t){}return t}();function Pe(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Fe(t,e){if(Pe.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Ae){t:{try{ve(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Ve[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Fe.Z.h.call(this)}}Pe.prototype.h=function(){this.defaultPrevented=!0},te(Fe,Pe);var Ve={2:"touch",3:"pen",4:"mouse"};Fe.prototype.h=function(){Fe.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Ue="closure_listenable_"+(1e6*Math.random()|0),je=0;function qe(t,e,n,i,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.ia=s,this.key=++je,this.ca=this.fa=!1}function Be(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function $e(t){this.src=t,this.g={},this.h=0}function Ke(t,e){var n=e.type;if(n in t.g){var i,s=t.g[n],r=ie(s,e);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(Be(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function He(t,e,n,i){for(var s=0;s<t.length;++s){var r=t[s];if(!r.ca&&r.listener==e&&r.capture==!!n&&r.ia==i)return s}return-1}$e.prototype.add=function(t,e,n,i,s){var r=t.toString();(t=this.g[r])||(t=this.g[r]=[],this.h++);var o=He(t,e,i,s);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new qe(e,this.src,r,!!i,s)).fa=n,t.push(e)),e};var ze="closure_lm_"+(1e6*Math.random()|0),Ge={};function We(t,e,n,i,s){if(i&&i.once)return Xe(t,e,n,i,s);if(Array.isArray(e)){for(var r=0;r<e.length;r++)We(t,e[r],n,i,s);return null}return n=sn(n),t&&t[Ue]?t.N(e,n,Gt(i)?!!i.capture:!!i,s):Qe(t,e,n,!1,i,s)}function Qe(t,e,n,i,s,r){if(!e)throw Error("Invalid event type");var o=Gt(s)?!!s.capture:!!s,a=en(t);if(a||(t[ze]=a=new $e(t)),(n=a.add(e,n,i,o,r)).proxy)return n;if(i=function(){var t=tn;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)Me||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),i,s);else if(t.attachEvent)t.attachEvent(Ze(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function Xe(t,e,n,i,s){if(Array.isArray(e)){for(var r=0;r<e.length;r++)Xe(t,e[r],n,i,s);return null}return n=sn(n),t&&t[Ue]?t.O(e,n,Gt(i)?!!i.capture:!!i,s):Qe(t,e,n,!0,i,s)}function Ye(t,e,n,i,s){if(Array.isArray(e))for(var r=0;r<e.length;r++)Ye(t,e[r],n,i,s);else i=Gt(i)?!!i.capture:!!i,n=sn(n),t&&t[Ue]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=He(r=t.g[e],n,i,s))&&(Be(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[e],t.h--))):t&&(t=en(t))&&(e=t.g[e.toString()],t=-1,e&&(t=He(e,n,i,s)),(n=-1<t?e[t]:null)&&Je(n))}function Je(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[Ue])Ke(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(Ze(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=en(e))?(Ke(n,t),0==n.h&&(n.src=null,e[ze]=null)):Be(t)}}}function Ze(t){return t in Ge?Ge[t]:Ge[t]="on"+t}function tn(t,e){if(t.ca)t=!0;else{e=new Fe(e,this);var n=t.listener,i=t.ia||t.src;t.fa&&Je(t),t=n.call(i,e)}return t}function en(t){return(t=t[ze])instanceof $e?t:null}var nn="__closure_events_fn_"+(1e9*Math.random()>>>0);function sn(t){return"function"==typeof t?t:(t[nn]||(t[nn]=function(e){return t.handleEvent(e)}),t[nn])}function rn(){ee.call(this),this.i=new $e(this),this.P=this,this.I=null}function on(t,e){var n,i=t.I;if(i)for(n=[];i;i=i.I)n.push(i);if(t=t.P,i=e.type||e,"string"==typeof e)e=new Pe(e,t);else if(e instanceof Pe)e.target=e.target||t;else{var s=e;ye(e=new Pe(i,t),s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.g=n[r];s=an(o,i,!0,e)&&s}if(s=an(o=e.g=t,i,!0,e)&&s,s=an(o,i,!1,e)&&s,n)for(r=0;r<n.length;r++)s=an(o=e.g=n[r],i,!1,e)&&s}function an(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&Ke(t.i,o),s=!1!==a.call(c,i)&&s}}return s&&!i.defaultPrevented}te(rn,ee),rn.prototype[Ue]=!0,rn.prototype.removeEventListener=function(t,e,n,i){Ye(this,t,e,n,i)},rn.prototype.M=function(){if(rn.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],i=0;i<n.length;i++)Be(n[i]);delete e.g[t],e.h--}}this.I=null},rn.prototype.N=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},rn.prototype.O=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};var cn=Kt.JSON.stringify;function hn(){var t=mn;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var un,ln=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new dn),(t=>t.reset()));class dn{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function fn(t){Kt.setTimeout((()=>{throw t}),0)}function pn(t,e){un||function(){var t=Kt.Promise.resolve(void 0);un=function(){t.then(yn)}}(),gn||(un(),gn=!0),mn.add(t,e)}var gn=!1,mn=new class{constructor(){this.h=this.g=null}add(t,e){const n=ln.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function yn(){for(var t;t=hn();){try{t.h.call(t.g)}catch(t){fn(t)}var e=ln;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}gn=!1}function vn(t,e){rn.call(this),this.h=t||1,this.g=e||Kt,this.j=Jt(this.kb,this),this.l=Date.now()}function wn(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function En(t,e,n){if("function"==typeof t)n&&(t=Jt(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Jt(t.handleEvent,t)}return 2147483647<Number(e)?-1:Kt.setTimeout(t,e||0)}function bn(t){t.g=En((()=>{t.g=null,t.i&&(t.i=!1,bn(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}te(vn,rn),(jt=vn.prototype).da=!1,jt.S=null,jt.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),on(this,"tick"),this.da&&(wn(this),this.start()))}},jt.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},jt.M=function(){vn.Z.M.call(this),wn(this),delete this.g};class Tn extends ee{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:bn(this)}M(){super.M(),this.g&&(Kt.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function In(t){ee.call(this),this.h=t,this.g={}}te(In,ee);var Sn=[];function An(t,e,n,i){Array.isArray(n)||(n&&(Sn[0]=n.toString()),n=Sn);for(var s=0;s<n.length;s++){var r=We(e,n[s],i||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}}function Cn(t){pe(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Je(t)}),t),t.g={}}function Dn(){this.g=!0}function kn(t,e,n,i){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var i=n[t];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<s.length;o++)s[o]=""}}}return cn(n)}catch(t){return e}}(t,n)+(i?" "+i:"")}))}In.prototype.M=function(){In.Z.M.call(this),Cn(this)},In.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Dn.prototype.Aa=function(){this.g=!1},Dn.prototype.info=function(){};var _n={},Nn=null;function Rn(){return Nn=Nn||new rn}function Ln(t){Pe.call(this,_n.Ma,t)}function xn(t){const e=Rn();on(e,new Ln(e,t))}function On(t,e){Pe.call(this,_n.STAT_EVENT,t),this.stat=e}function Mn(t){const e=Rn();on(e,new On(e,t))}function Pn(t,e){Pe.call(this,_n.Na,t),this.size=e}function Fn(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return Kt.setTimeout((function(){t()}),e)}_n.Ma="serverreachability",te(Ln,Pe),_n.STAT_EVENT="statevent",te(On,Pe),_n.Na="timingevent",te(Pn,Pe);var Vn={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Un={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function jn(){}function qn(t){return t.h||(t.h=t.i())}function Bn(){}jn.prototype.h=null;var $n,Kn={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Hn(){Pe.call(this,"d")}function zn(){Pe.call(this,"c")}function Gn(){}function Wn(t,e,n,i){this.l=t,this.j=e,this.m=n,this.X=i||1,this.V=new In(this),this.P=Xn,t=Se?125:void 0,this.W=new vn(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Qn}function Qn(){this.i=null,this.g="",this.h=!1}te(Hn,Pe),te(zn,Pe),te(Gn,jn),Gn.prototype.g=function(){return new XMLHttpRequest},Gn.prototype.i=function(){return{}},$n=new Gn;var Xn=45e3,Yn={},Jn={};function Zn(t,e,n){t.K=1,t.v=Ti(mi(e)),t.s=n,t.U=!0,ti(t,null)}function ti(t,e){t.F=Date.now(),si(t),t.A=mi(t.v);var n=t.A,i=t.X;Array.isArray(i)||(i=[String(i)]),Mi(n.h,"t",i),t.C=0,n=t.l.H,t.h=new Qn,t.g=Ms(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Tn(Jt(t.Ia,t,t.g),t.O)),An(t.V,t.g,"readystatechange",t.gb),e=t.H?ge(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),xn(1),function(t,e,n,i,s,r){t.info((function(){if(t.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var h=a[c].split("=");if(1<h.length){var u=h[0];h=h[1];var l=u.split("_");o=2<=l.length&&"type"==l[1]?o+(u+"=")+h+"&":o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function ei(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function ni(t,e,n){let i,s=!0;for(;!t.I&&t.C<n.length;){if(i=ii(t,n),i==Jn){4==e&&(t.o=4,Mn(14),s=!1),kn(t.j,t.m,null,"[Incomplete Response]");break}if(i==Yn){t.o=4,Mn(15),kn(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}kn(t.j,t.m,i,null),hi(t,i)}ei(t)&&i!=Jn&&i!=Yn&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Mn(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ds(e),e.L=!0,Mn(11))):(kn(t.j,t.m,n,"[Invalid Chunked Response]"),ci(t),ai(t))}function ii(t,e){var n=t.C,i=e.indexOf("\n",n);return-1==i?Jn:(n=Number(e.substring(n,i)),isNaN(n)?Yn:(i+=1)+n>e.length?Jn:(e=e.substr(i,n),t.C=i+n,e))}function si(t){t.Y=Date.now()+t.P,ri(t,t.P)}function ri(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Fn(Jt(t.eb,t),e)}function oi(t){t.B&&(Kt.clearTimeout(t.B),t.B=null)}function ai(t){0==t.l.G||t.I||Ns(t.l,t)}function ci(t){oi(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,wn(t.W),Cn(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function hi(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||qi(n.i,t)))if(n.I=t.N,!t.J&&qi(n.i,t)&&3==n.G){try{var i=n.Ca.g.parse(e)}catch(t){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;_s(n),vs(n)}Cs(n),Mn(18)}}else n.ta=s[1],0<n.ta-n.U&&37500>s[2]&&n.N&&0==n.A&&!n.v&&(n.v=Fn(Jt(n.ab,n),6e3));if(1>=ji(n.i)&&n.ka){try{n.ka()}catch(t){}n.ka=void 0}}else Ls(n,11)}else if((t.J||n.g==t)&&_s(n),!ae(e))for(s=n.Ca.g.parse(e),e=0;e<s.length;e++){let h=s[e];if(n.U=h[0],h=h[1],2==n.G)if("c"==h[0]){n.J=h[1],n.la=h[2];const e=h[3];null!=e&&(n.ma=e,n.h.info("VER="+n.ma));const s=h[4];null!=s&&(n.za=s,n.h.info("SVER="+n.za));const u=h[5];null!=u&&"number"==typeof u&&0<u&&(i=1.5*u,n.K=i,n.h.info("backChannelRequestTimeoutMs_="+i)),i=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=i.i;!r.g&&(ue(t,"spdy")||ue(t,"quic")||ue(t,"h2"))&&(r.j=r.l,r.g=new Set,r.h&&(Bi(r,r.h),r.h=null))}if(i.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(i.sa=t,bi(i.F,i.D,t))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=t;if((i=n).oa=Os(i,i.H?i.la:null,i.W),o.J){$i(i.i,o);var a=o,c=i.K;c&&a.setTimeout(c),a.B&&(oi(a),si(a)),i.g=o}else As(i);0<n.l.length&&bs(n)}else"stop"!=h[0]&&"close"!=h[0]||Ls(n,7);else 3==n.G&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?Ls(n,7):ys(n):"noop"!=h[0]&&n.j&&n.j.wa(h),n.A=0)}xn(4)}catch(t){}}function ui(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(zt(t)||"string"==typeof t)se(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(zt(t)||"string"==typeof t){n=[];for(var i=t.length,s=0;s<i;s++)n.push(s)}else for(s in n=[],i=0,t)n[i++]=s;i=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(zt(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}(t),s=i.length;for(var r=0;r<s;r++)e.call(void 0,i[r],n&&n[r],t)}}function li(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var i=0;i<n;i+=2)this.set(arguments[i],arguments[i+1])}else if(t)if(t instanceof li)for(n=t.T(),i=0;i<n.length;i++)this.set(n[i],t.get(n[i]));else for(i in t)this.set(i,t[i])}function di(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var i=t.g[e];fi(t.h,i)&&(t.g[n++]=i),e++}t.g.length=n}if(t.i!=t.g.length){var s={};for(n=e=0;e<t.g.length;)fi(s,i=t.g[e])||(t.g[n++]=i,s[i]=1),e++;t.g.length=n}}function fi(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(jt=Wn.prototype).setTimeout=function(t){this.P=t},jt.gb=function(t){t=t.target;const e=this.L;e&&3==ds(t)?e.l():this.Ia(t)},jt.Ia=function(t){try{if(t==this.g)t:{const u=ds(this.g);var e=this.g.Da();const l=this.g.ba();if(!(3>u)&&(3!=u||Se||this.g&&(this.h.h||this.g.ga()||fs(this.g)))){this.I||4!=u||7==e||xn(8==e||0>=l?3:2),oi(this);var n=this.g.ba();this.N=n;e:if(ei(this)){var i=fs(this.g);t="";var s=i.length,r=4==ds(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){ci(this),ai(this);var o="";break e}this.h.i=new Kt.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(i[e],{stream:r&&e==s-1});i.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(t,e,n,i,s,r,o){t.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.X,u,n),this.i){if(this.$&&!this.J){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ae(a)){var h=a;break e}}h=null}if(!(n=h)){this.i=!1,this.o=3,Mn(12),ci(this),ai(this);break t}kn(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,hi(this,n)}this.U?(ni(this,u,o),Se&&this.i&&3==u&&(An(this.V,this.W,"tick",this.fb),this.W.start())):(kn(this.j,this.m,o,null),hi(this,o)),4==u&&ci(this),this.i&&!this.I&&(4==u?Ns(this.l,this):(this.i=!1,si(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Mn(12)):(this.o=0,Mn(13)),ci(this),ai(this)}}}catch(t){}},jt.fb=function(){if(this.g){var t=ds(this.g),e=this.g.ga();this.C<e.length&&(oi(this),ni(this,t,e),this.i&&4!=t&&si(this))}},jt.cancel=function(){this.I=!0,ci(this)},jt.eb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(xn(3),Mn(17)),ci(this),this.o=2,ai(this)):ri(this,this.Y-t)},(jt=li.prototype).R=function(){di(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},jt.T=function(){return di(this),this.g.concat()},jt.get=function(t,e){return fi(this.h,t)?this.h[t]:e},jt.set=function(t,e){fi(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},jt.forEach=function(t,e){for(var n=this.T(),i=0;i<n.length;i++){var s=n[i],r=this.get(s);t.call(e,r,s,this)}};var pi=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function gi(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof gi){this.g=void 0!==e?e:t.g,yi(this,t.j),this.s=t.s,vi(this,t.i),wi(this,t.m),this.l=t.l,e=t.h;var n=new Ri;n.i=e.i,e.g&&(n.g=new li(e.g),n.h=e.h),Ei(this,n),this.o=t.o}else t&&(n=String(t).match(pi))?(this.g=!!e,yi(this,n[1]||"",!0),this.s=Ii(n[2]||""),vi(this,n[3]||"",!0),wi(this,n[4]),this.l=Ii(n[5]||"",!0),Ei(this,n[6]||"",!0),this.o=Ii(n[7]||"")):(this.g=!!e,this.h=new Ri(null,this.g))}function mi(t){return new gi(t)}function yi(t,e,n){t.j=n?Ii(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function vi(t,e,n){t.i=n?Ii(e,!0):e}function wi(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ei(t,e,n){e instanceof Ri?(t.h=e,function(t,e){e&&!t.j&&(Li(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(xi(this,e),Mi(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=Si(e,_i)),t.h=new Ri(e,t.g))}function bi(t,e,n){t.h.set(e,n)}function Ti(t){return bi(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Ii(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Si(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Ai),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ai(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}gi.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Si(e,Ci,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Si(e,Ci,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(Si(n,"/"==n.charAt(0)?ki:Di,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Si(n,Ni)),t.join("")};var Ci=/[#\/\?@]/g,Di=/[#\?:]/g,ki=/[#\?]/g,_i=/[#\?@]/g,Ni=/#/g;function Ri(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Li(t){t.g||(t.g=new li,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),s=null;if(0<=i){var r=t[n].substring(0,i);s=t[n].substring(i+1)}else r=t[n];e(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function xi(t,e){Li(t),e=Pi(t,e),fi(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,fi((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&di(t)))}function Oi(t,e){return Li(t),e=Pi(t,e),fi(t.g.h,e)}function Mi(t,e,n){xi(t,e),0<n.length&&(t.i=null,t.g.set(Pi(t,e),oe(n)),t.h+=n.length)}function Pi(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Fi(t){this.l=t||Vi,t=Kt.PerformanceNavigationTiming?0<(t=Kt.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(Kt.g&&Kt.g.Ea&&Kt.g.Ea()&&Kt.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(jt=Ri.prototype).add=function(t,e){Li(this),this.i=null,t=Pi(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},jt.forEach=function(t,e){Li(this),this.g.forEach((function(n,i){se(n,(function(n){t.call(e,n,i,this)}),this)}),this)},jt.T=function(){Li(this);for(var t=this.g.R(),e=this.g.T(),n=[],i=0;i<e.length;i++)for(var s=t[i],r=0;r<s.length;r++)n.push(e[i]);return n},jt.R=function(t){Li(this);var e=[];if("string"==typeof t)Oi(this,t)&&(e=re(e,this.g.get(Pi(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=re(e,t[n])}return e},jt.set=function(t,e){return Li(this),this.i=null,Oi(this,t=Pi(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},jt.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},jt.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var i=e[n],s=encodeURIComponent(String(i));i=this.R(i);for(var r=0;r<i.length;r++){var o=s;""!==i[r]&&(o+="="+encodeURIComponent(String(i[r]))),t.push(o)}}return this.i=t.join("&")};var Vi=10;function Ui(t){return!!t.h||!!t.g&&t.g.size>=t.j}function ji(t){return t.h?1:t.g?t.g.size:0}function qi(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Bi(t,e){t.g?t.g.add(e):t.h=e}function $i(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Ki(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return oe(t.i)}function Hi(){}function zi(){this.g=new Hi}function Gi(t,e,n){const i=n||"";try{ui(t,(function(t,n){let s=t;Gt(t)&&(s=cn(t)),e.push(i+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}function Wi(t,e,n,i,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(i)}catch(t){}}function Qi(t){this.l=t.$b||null,this.j=t.ib||!1}function Xi(t,e){rn.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Yi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Fi.prototype.cancel=function(){if(this.i=Ki(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},Hi.prototype.stringify=function(t){return Kt.JSON.stringify(t,void 0)},Hi.prototype.parse=function(t){return Kt.JSON.parse(t,void 0)},te(Qi,jn),Qi.prototype.g=function(){return new Xi(this.l,this.j)},Qi.prototype.i=function(t){return function(){return t}}({}),te(Xi,rn);var Yi=0;function Ji(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Zi(t){t.readyState=4,t.l=null,t.j=null,t.A=null,ts(t)}function ts(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(jt=Xi.prototype).open=function(t,e){if(this.readyState!=Yi)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,ts(this)},jt.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||Kt).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},jt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Zi(this)),this.readyState=Yi},jt.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,ts(this)),this.g&&(this.readyState=3,ts(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==Kt.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ji(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},jt.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Zi(this):ts(this),3==this.readyState&&Ji(this)}},jt.Ua=function(t){this.g&&(this.response=this.responseText=t,Zi(this))},jt.Ta=function(t){this.g&&(this.response=t,Zi(this))},jt.ha=function(){this.g&&Zi(this)},jt.setRequestHeader=function(t,e){this.v.append(t,e)},jt.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},jt.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Xi.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var es=Kt.JSON.parse;function ns(t){rn.call(this),this.headers=new li,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=is,this.K=this.L=!1}te(ns,rn);var is="",ss=/^https?$/i,rs=["POST","PUT"];function os(t){return"content-type"==t.toLowerCase()}function as(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,cs(t),us(t)}function cs(t){t.D||(t.D=!0,on(t,"complete"),on(t,"error"))}function hs(t){if(t.h&&void 0!==$t&&(!t.C[1]||4!=ds(t)||2!=t.ba()))if(t.v&&4==ds(t))En(t.Fa,0,t);else if(on(t,"readystatechange"),4==ds(t)){t.h=!1;try{const a=t.ba();t:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===a){var s=String(t.H).match(pi)[1]||null;if(!s&&Kt.self&&Kt.self.location){var r=Kt.self.location.protocol;s=r.substr(0,r.length-1)}i=!ss.test(s?s.toLowerCase():"")}n=i}if(n)on(t,"complete"),on(t,"success");else{t.m=6;try{var o=2<ds(t)?t.g.statusText:""}catch(t){o=""}t.j=o+" ["+t.ba()+"]",cs(t)}}finally{us(t)}}}function us(t,e){if(t.g){ls(t);const n=t.g,i=t.C[0]?Ht:null;t.g=null,t.C=null,e||on(t,"ready");try{n.onreadystatechange=i}catch(t){}}}function ls(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(Kt.clearTimeout(t.A),t.A=null)}function ds(t){return t.g?t.g.readyState:0}function fs(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case is:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function ps(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=function(t){let e="";return pe(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):bi(t,e,n))}function gs(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function ms(t){this.za=0,this.l=[],this.h=new Dn,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=gs("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=gs("baseRetryDelayMs",5e3,t),this.$a=gs("retryDelaySeedMs",1e4,t),this.Ya=gs("forwardChannelMaxRetries",2,t),this.ra=gs("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new Fi(t&&t.concurrentRequestLimit),this.Ca=new zi,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function ys(t){if(ws(t),3==t.G){var e=t.V++,n=mi(t.F);bi(n,"SID",t.J),bi(n,"RID",e),bi(n,"TYPE","terminate"),Is(t,n),(e=new Wn(t,t.h,e,void 0)).K=2,e.v=Ti(mi(n)),n=!1,Kt.navigator&&Kt.navigator.sendBeacon&&(n=Kt.navigator.sendBeacon(e.v.toString(),"")),!n&&Kt.Image&&((new Image).src=e.v,n=!0),n||(e.g=Ms(e.l,null),e.g.ea(e.v)),e.F=Date.now(),si(e)}xs(t)}function vs(t){t.g&&(Ds(t),t.g.cancel(),t.g=null)}function ws(t){vs(t),t.u&&(Kt.clearTimeout(t.u),t.u=null),_s(t),t.i.cancel(),t.m&&("number"==typeof t.m&&Kt.clearTimeout(t.m),t.m=null)}function Es(t,e){t.l.push(new class{constructor(t,e){this.h=t,this.g=e}}(t.Za++,e)),3==t.G&&bs(t)}function bs(t){Ui(t.i)||t.m||(t.m=!0,pn(t.Ha,t),t.C=0)}function Ts(t,e){var n;n=e?e.m:t.V++;const i=mi(t.F);bi(i,"SID",t.J),bi(i,"RID",n),bi(i,"AID",t.U),Is(t,i),t.o&&t.s&&ps(i,t.o,t.s),n=new Wn(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Ss(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Bi(t.i,n),Zn(n,i,e)}function Is(t,e){t.j&&ui({},(function(t,n){bi(e,n,t)}))}function Ss(t,e,n){n=Math.min(t.l.length,n);var i=t.j?Jt(t.j.Oa,t.j,t):null;t:{var s=t.l;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let r=!0;for(let o=0;o<n;o++){let n=s[o].h;const a=s[o].g;if(n-=e,0>n)e=Math.max(0,s[o].h-100),r=!1;else try{Gi(a,t,"req"+n+"_")}catch(t){i&&i(a)}}if(r){i=t.join("&");break t}}}return t=t.l.splice(0,n),e.D=t,i}function As(t){t.g||t.u||(t.Y=1,pn(t.Ga,t),t.A=0)}function Cs(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=Fn(Jt(t.Ga,t),Rs(t,t.A)),t.A++,0))}function Ds(t){null!=t.B&&(Kt.clearTimeout(t.B),t.B=null)}function ks(t){t.g=new Wn(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=mi(t.oa);bi(e,"RID","rpc"),bi(e,"SID",t.J),bi(e,"CI",t.N?"0":"1"),bi(e,"AID",t.U),Is(t,e),bi(e,"TYPE","xmlhttp"),t.o&&t.s&&ps(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Ti(mi(e)),n.s=null,n.U=!0,ti(n,t)}function _s(t){null!=t.v&&(Kt.clearTimeout(t.v),t.v=null)}function Ns(t,e){var n=null;if(t.g==e){_s(t),Ds(t),t.g=null;var i=2}else{if(!qi(t.i,e))return;n=e.D,$i(t.i,e),i=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==i){n=e.s?e.s.length:0,e=Date.now()-e.F;var s=t.C;on(i=Rn(),new Pn(i,n,e,s)),bs(t)}else As(t);else if(3==(s=e.o)||0==s&&0<t.I||!(1==i&&function(t,e){return!(ji(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Fn(Jt(t.Ha,t,e),Rs(t,t.C)),t.C++,0)))}(t,e)||2==i&&Cs(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:Ls(t,5);break;case 4:Ls(t,10);break;case 3:Ls(t,6);break;default:Ls(t,2)}}function Rs(t,e){let n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Ls(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var i=Jt(t.jb,t);n||(n=new gi("//www.google.com/images/cleardot.gif"),Kt.location&&"http"==Kt.location.protocol||yi(n,"https"),Ti(n)),function(t,e){const n=new Dn;if(Kt.Image){const i=new Image;i.onload=Zt(Wi,n,i,"TestLoadImage: loaded",!0,e),i.onerror=Zt(Wi,n,i,"TestLoadImage: error",!1,e),i.onabort=Zt(Wi,n,i,"TestLoadImage: abort",!1,e),i.ontimeout=Zt(Wi,n,i,"TestLoadImage: timeout",!1,e),Kt.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=t}else e(!1)}(n.toString(),i)}else Mn(2);t.G=0,t.j&&t.j.va(e),xs(t),ws(t)}function xs(t){t.G=0,t.I=-1,t.j&&(0==Ki(t.i).length&&0==t.l.length||(t.i.i.length=0,oe(t.l),t.l.length=0),t.j.ua())}function Os(t,e,n){let i=function(t){return t instanceof gi?mi(t):new gi(t,void 0)}(n);if(""!=i.i)e&&vi(i,e+"."+i.i),wi(i,i.m);else{const t=Kt.location;i=function(t,e,n,i){var s=new gi(null,void 0);return t&&yi(s,t),e&&vi(s,e),n&&wi(s,n),i&&(s.l=i),s}(t.protocol,e?e+"."+t.hostname:t.hostname,+t.port,n)}return t.aa&&pe(t.aa,(function(t,e){bi(i,e,t)})),e=t.D,n=t.sa,e&&n&&bi(i,e,n),bi(i,"VER",t.ma),Is(t,i),i}function Ms(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new ns(new Qi({ib:!0})):new ns(t.qa)).L=t.H,e}function Ps(){}function Fs(){if(Te&&!(10<=Number(Oe)))throw Error("Environmental error: no available transport.")}function Vs(t,e){rn.call(this),this.g=new ms(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!ae(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!ae(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new qs(this)}function Us(t){Hn.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function js(){zn.call(this),this.status=1}function qs(t){this.g=t}(jt=ns.prototype).ea=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():$n.g(),this.C=this.u?qn(this.u):qn($n),this.g.onreadystatechange=Jt(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void as(this,t)}t=n||"";const s=new li(this.headers);i&&ui(i,(function(t,e){s.set(e,t)})),i=function(t){t:{var e=os;const n=t.length,i="string"==typeof t?t.split(""):t;for(let s=0;s<n;s++)if(s in i&&e.call(void 0,i[s],s,t)){e=s;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(s.T()),n=Kt.FormData&&t instanceof Kt.FormData,!(0<=ie(rs,e))||i||n||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ls(this),0<this.B&&((this.K=function(t){return Te&&xe()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Jt(this.pa,this)):this.A=En(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){as(this,t)}},jt.pa=function(){void 0!==$t&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,on(this,"timeout"),this.abort(8))},jt.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,on(this,"complete"),on(this,"abort"),us(this))},jt.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),us(this,!0)),ns.Z.M.call(this)},jt.Fa=function(){this.s||(this.F||this.v||this.l?hs(this):this.cb())},jt.cb=function(){hs(this)},jt.ba=function(){try{return 2<ds(this)?this.g.status:-1}catch(t){return-1}},jt.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},jt.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),es(e)}},jt.Da=function(){return this.m},jt.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(jt=ms.prototype).ma=8,jt.G=1,jt.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},jt.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const s=new Wn(this,this.h,t,void 0);let r=this.s;if(this.P&&(r?(r=ge(r),ye(r,this.P)):r=this.P),null===this.o&&(s.H=r),this.ja)t:{for(var e=0,n=0;n<this.l.length;n++){var i=this.l[n];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=n;break t}if(4096===e||n===this.l.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Ss(this,s,e),bi(n=mi(this.F),"RID",t),bi(n,"CVER",22),this.D&&bi(n,"X-HTTP-Session-Id",this.D),Is(this,n),this.o&&r&&ps(n,this.o,r),Bi(this.i,s),this.Ra&&bi(n,"TYPE","init"),this.ja?(bi(n,"$req",e),bi(n,"SID","null"),s.$=!0,Zn(s,n,null)):Zn(s,n,e),this.G=2}}else 3==this.G&&(t?Ts(this,t):0==this.l.length||Ui(this.i)||Ts(this))},jt.Ga=function(){if(this.u=null,ks(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Fn(Jt(this.bb,this),t)}},jt.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Mn(10),vs(this),ks(this))},jt.ab=function(){null!=this.v&&(this.v=null,vs(this),Cs(this),Mn(19))},jt.jb=function(t){t?(this.h.info("Successfully pinged google.com"),Mn(2)):(this.h.info("Failed to ping google.com"),Mn(1))},(jt=Ps.prototype).xa=function(){},jt.wa=function(){},jt.va=function(){},jt.ua=function(){},jt.Oa=function(){},Fs.prototype.g=function(t,e){return new Vs(t,e)},te(Vs,rn),Vs.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),pn(Jt(t.hb,t,e))),Mn(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=Os(t,null,t.W),bs(t)},Vs.prototype.close=function(){ys(this.g)},Vs.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Es(this.g,e)}else this.v?((e={}).__data__=cn(t),Es(this.g,e)):Es(this.g,t)},Vs.prototype.M=function(){this.g.j=null,delete this.j,ys(this.g),delete this.g,Vs.Z.M.call(this)},te(Us,Hn),te(js,zn),te(qs,Ps),qs.prototype.xa=function(){on(this.g,"a")},qs.prototype.wa=function(t){on(this.g,new Us(t))},qs.prototype.va=function(t){on(this.g,new js(t))},qs.prototype.ua=function(){on(this.g,"b")},Fs.prototype.createWebChannel=Fs.prototype.g,Vs.prototype.send=Vs.prototype.u,Vs.prototype.open=Vs.prototype.m,Vs.prototype.close=Vs.prototype.close,Vn.NO_ERROR=0,Vn.TIMEOUT=8,Vn.HTTP_ERROR=6,Un.COMPLETE="complete",Bn.EventType=Kn,Kn.OPEN="a",Kn.CLOSE="b",Kn.ERROR="c",Kn.MESSAGE="d",rn.prototype.listen=rn.prototype.N,ns.prototype.listenOnce=ns.prototype.O,ns.prototype.getLastError=ns.prototype.La,ns.prototype.getLastErrorCode=ns.prototype.Da,ns.prototype.getStatus=ns.prototype.ba,ns.prototype.getResponseJson=ns.prototype.Qa,ns.prototype.getResponseText=ns.prototype.ga,ns.prototype.send=ns.prototype.ea;var Bs=Bt.createWebChannelTransport=function(){return new Fs},$s=Bt.getStatEventTarget=function(){return Rn()},Ks=Bt.ErrorCode=Vn,Hs=Bt.EventType=Un,zs=Bt.Event=_n,Gs=Bt.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Ws=Bt.FetchXmlHttpFactory=Qi,Qs=Bt.WebChannel=Bn,Xs=Bt.XhrIo=ns;const Ys="@firebase/firestore";class Js{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Js.UNAUTHENTICATED=new Js(null),Js.GOOGLE_CREDENTIALS=new Js("google-credentials-uid"),Js.FIRST_PARTY=new Js("first-party-uid"),Js.MOCK_USER=new Js("mock-user");let Zs="9.6.1";const tr=new T("@firebase/firestore");function er(){return tr.logLevel}function nr(t,...e){if(tr.logLevel<=m.DEBUG){const n=e.map(rr);tr.debug(`Firestore (${Zs}): ${t}`,...n)}}function ir(t,...e){if(tr.logLevel<=m.ERROR){const n=e.map(rr);tr.error(`Firestore (${Zs}): ${t}`,...n)}}function sr(t,...e){if(tr.logLevel<=m.WARN){const n=e.map(rr);tr.warn(`Firestore (${Zs}): ${t}`,...n)}}function rr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function or(t="Unexpected state"){const e=`FIRESTORE (${Zs}) INTERNAL ASSERTION FAILED: `+t;throw ir(e),new Error(e)}function ar(t,e){t||or()}function cr(t,e){return t}const hr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ur extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class lr{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class dr{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class fr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Js.UNAUTHENTICATED)))}shutdown(){}}class pr{constructor(t){this.t=t,this.currentUser=Js.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new lr;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new lr,t.enqueueRetryable((()=>i(this.currentUser)))};const r=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await i(this.currentUser)}))},o=t=>{nr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(nr("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new lr)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(nr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(ar("string"==typeof e.accessToken),new dr(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return ar(null===t||"string"==typeof t),new Js(t)}}class gr{constructor(t,e,n){this.type="FirstParty",this.user=Js.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",e);const i=t.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class mr{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new gr(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(Js.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class yr{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class vr{constructor(t){this.g=t,this.forceRefresh=!1,this.appCheck=null}start(t,e){this.o=n=>{t.enqueueRetryable((()=>(t=>(null!=t.error&&nr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`),e(t.token)))(n)))};const n=t=>{nr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.g.onInit((t=>n(t))),setTimeout((()=>{if(!this.appCheck){const t=this.g.getImmediate({optional:!0});t?n(t):nr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(ar("string"==typeof t.token),new yr(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class wr{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.p(t),this.T=t=>e.writeSequenceNumber(t))}p(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.T&&this.T(t),t}}function Er(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}wr.I=-1;class br{static A(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const i=Er(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+=t.charAt(i[s]%t.length))}return n}}function Tr(t,e){return t<e?-1:t>e?1:0}function Ir(t,e,n){return t.length===e.length&&t.every(((t,i)=>n(t,e[i])))}class Sr{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new ur(hr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new ur(hr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ur(hr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ur(hr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Sr.fromMillis(Date.now())}static fromDate(t){return Sr.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Sr(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Tr(this.nanoseconds,t.nanoseconds):Tr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Ar{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Ar(t)}static min(){return new Ar(new Sr(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Cr(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Dr(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function kr(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class _r{constructor(t,e,n){void 0===e?e=0:e>t.length&&or(),void 0===n?n=t.length-e:n>t.length-e&&or(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===_r.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof _r?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.get(i),s=e.get(i);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Nr extends _r{construct(t,e,n){return new Nr(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new ur(hr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new Nr(e)}static emptyPath(){return new Nr([])}}const Rr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Lr extends _r{construct(t,e,n){return new Lr(t,e,n)}static isValidIdentifier(t){return Rr.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Lr.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Lr(["__name__"])}static fromServerFormat(t){const e=[];let n="",i=0;const s=()=>{if(0===n.length)throw new ur(hr.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;i<t.length;){const e=t[i];if("\\"===e){if(i+1===t.length)throw new ur(hr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[i+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new ur(hr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,i+=2}else"`"===e?(r=!r,i++):"."!==e||r?(n+=e,i++):(s(),i++)}if(s(),r)throw new ur(hr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Lr(e)}static emptyPath(){return new Lr([])}}class xr{constructor(t){this.fields=t,t.sort(Lr.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Ir(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Or{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new Or(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Or(e)}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Tr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Or.EMPTY_BYTE_STRING=new Or("");const Mr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pr(t){if(ar(!!t),"string"==typeof t){let e=0;const n=Mr.exec(t);if(ar(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Fr(t.seconds),nanos:Fr(t.nanos)}}function Fr(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Vr(t){return"string"==typeof t?Or.fromBase64String(t):Or.fromUint8Array(t)}function Ur(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function jr(t){const e=t.mapValue.fields.__previous_value__;return Ur(e)?jr(e):e}function qr(t){const e=Pr(t.mapValue.fields.__local_write_time__.timestampValue);return new Sr(e.seconds,e.nanos)}function Br(t){return null==t}function $r(t){return 0===t&&1/t==-1/0}class Kr{constructor(t){this.path=t}static fromPath(t){return new Kr(Nr.fromString(t))}static fromName(t){return new Kr(Nr.fromString(t).popFirst(5))}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===Nr.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return Nr.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Kr(new Nr(t.slice()))}}function Hr(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ur(t)?4:10:or()}function zr(t,e){const n=Hr(t);if(n!==Hr(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return qr(t).isEqual(qr(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Pr(t.timestampValue),i=Pr(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Vr(t.bytesValue).isEqual(Vr(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Fr(t.geoPointValue.latitude)===Fr(e.geoPointValue.latitude)&&Fr(t.geoPointValue.longitude)===Fr(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Fr(t.integerValue)===Fr(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Fr(t.doubleValue),i=Fr(e.doubleValue);return n===i?$r(n)===$r(i):isNaN(n)&&isNaN(i)}return!1}(t,e);case 9:return Ir(t.arrayValue.values||[],e.arrayValue.values||[],zr);case 10:return function(t,e){const n=t.mapValue.fields||{},i=e.mapValue.fields||{};if(Cr(n)!==Cr(i))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===i[t]||!zr(n[t],i[t])))return!1;return!0}(t,e);default:return or()}}function Gr(t,e){return void 0!==(t.values||[]).find((t=>zr(t,e)))}function Wr(t,e){const n=Hr(t),i=Hr(e);if(n!==i)return Tr(n,i);switch(n){case 0:return 0;case 1:return Tr(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Fr(t.integerValue||t.doubleValue),i=Fr(e.integerValue||e.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(t,e);case 3:return Qr(t.timestampValue,e.timestampValue);case 4:return Qr(qr(t),qr(e));case 5:return Tr(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Vr(t),i=Vr(e);return n.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),i=e.split("/");for(let t=0;t<n.length&&t<i.length;t++){const e=Tr(n[t],i[t]);if(0!==e)return e}return Tr(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Tr(Fr(t.latitude),Fr(e.latitude));return 0!==n?n:Tr(Fr(t.longitude),Fr(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],i=e.values||[];for(let t=0;t<n.length&&t<i.length;++t){const e=Wr(n[t],i[t]);if(e)return e}return Tr(n.length,i.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},i=Object.keys(n),s=e.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let t=0;t<i.length&&t<r.length;++t){const e=Tr(i[t],r[t]);if(0!==e)return e;const o=Wr(n[i[t]],s[r[t]]);if(0!==o)return o}return Tr(i.length,r.length)}(t.mapValue,e.mapValue);default:throw or()}}function Qr(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Tr(t,e);const n=Pr(t),i=Pr(e),s=Tr(n.seconds,i.seconds);return 0!==s?s:Tr(n.nanos,i.nanos)}function Xr(t){return Yr(t)}function Yr(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Pr(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Vr(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,Kr.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const i of t.values||[])n?n=!1:e+=",",e+=Yr(i);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",i=!0;for(const s of e)i?i=!1:n+=",",n+=`${s}:${Yr(t.fields[s])}`;return n+"}"}(t.mapValue):or();var e,n}function Jr(t){return!!t&&"integerValue"in t}function Zr(t){return!!t&&"arrayValue"in t}function to(t){return!!t&&"nullValue"in t}function eo(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function no(t){return!!t&&"mapValue"in t}function io(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Dr(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=io(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=io(t.arrayValue.values[n]);return e}return Object.assign({},t)}class so{constructor(t){this.value=t}static empty(){return new so({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!no(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=io(e)}setAll(t){let e=Lr.emptyPath(),n={},i=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,i),n={},i=[],e=s.popLast()}t?n[s.lastSegment()]=io(t):i.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){const e=this.field(t.popLast());no(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return zr(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];no(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){Dr(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new so(io(this.value))}}function ro(t){const e=[];return Dr(t.fields,((t,n)=>{const i=new Lr([t]);if(no(n)){const t=ro(n.mapValue).fields;if(0===t.length)e.push(i);else for(const n of t)e.push(i.child(n))}else e.push(i)})),new xr(e)}class oo{constructor(t,e,n,i,s){this.key=t,this.documentType=e,this.version=n,this.data=i,this.documentState=s}static newInvalidDocument(t){return new oo(t,0,Ar.min(),so.empty(),0)}static newFoundDocument(t,e,n){return new oo(t,1,e,n,0)}static newNoDocument(t,e){return new oo(t,2,e,so.empty(),0)}static newUnknownDocument(t,e){return new oo(t,3,e,so.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=so.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=so.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof oo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}clone(){return new oo(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ao{constructor(t,e=null,n=[],i=[],s=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=o,this.R=null}}function co(t,e=null,n=[],i=[],s=null,r=null,o=null){return new ao(t,e,n,i,s,r,o)}function ho(t){const e=cr(t);if(null===e.R){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>function(t){return t.field.canonicalString()+t.op.toString()+Xr(t.value)}(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Br(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Io(e.startAt)),e.endAt&&(t+="|ub:",t+=Io(e.endAt)),e.R=t}return e.R}function uo(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Ao(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(n=t.filters[s],i=e.filters[s],n.op!==i.op||!n.field.isEqual(i.field)||!zr(n.value,i.value))return!1;var n,i;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Do(t.startAt,e.startAt)&&Do(t.endAt,e.endAt)}function lo(t){return Kr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class fo extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.P(t,e,n):new po(t,e,n):"array-contains"===e?new vo(t,n):"in"===e?new wo(t,n):"not-in"===e?new Eo(t,n):"array-contains-any"===e?new bo(t,n):new fo(t,e,n)}static P(t,e,n){return"in"===e?new go(t,n):new mo(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.v(Wr(e,this.value)):null!==e&&Hr(this.value)===Hr(e)&&this.v(Wr(e,this.value))}v(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return or()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class po extends fo{constructor(t,e,n){super(t,e,n),this.key=Kr.fromName(n.referenceValue)}matches(t){const e=Kr.comparator(t.key,this.key);return this.v(e)}}class go extends fo{constructor(t,e){super(t,"in",e),this.keys=yo(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class mo extends fo{constructor(t,e){super(t,"not-in",e),this.keys=yo(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function yo(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>Kr.fromName(t.referenceValue)))}class vo extends fo{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Zr(e)&&Gr(e.arrayValue,this.value)}}class wo extends fo{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Gr(this.value.arrayValue,e)}}class Eo extends fo{constructor(t,e){super(t,"not-in",e)}matches(t){if(Gr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Gr(this.value.arrayValue,e)}}class bo extends fo{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Zr(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Gr(this.value.arrayValue,t)))}}class To{constructor(t,e){this.position=t,this.before=e}}function Io(t){return`${t.before?"b":"a"}:${t.position.map((t=>Xr(t))).join(",")}`}class So{constructor(t,e="asc"){this.field=t,this.dir=e}}function Ao(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Co(t,e,n){let i=0;for(let s=0;s<t.position.length;s++){const r=e[s],o=t.position[s];if(i=r.field.isKeyField()?Kr.comparator(Kr.fromName(o.referenceValue),n.key):Wr(o,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return t.before?i<=0:i<0}function Do(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!zr(t.position[n],e.position[n]))return!1;return!0}class ko{constructor(t,e=null,n=[],i=[],s=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=o,this.endAt=a,this.S=null,this.D=null,this.startAt,this.endAt}}function _o(t){return new ko(t)}function No(t){return!Br(t.limit)&&"F"===t.limitType}function Ro(t){return!Br(t.limit)&&"L"===t.limitType}function Lo(t){const e=cr(t);if(null===e.S){e.S=[];const t=function(t){for(const e of t.filters)if(e.V())return e.field;return null}(e),n=function(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}(e);if(null!==t&&null===n)t.isKeyField()||e.S.push(new So(t)),e.S.push(new So(Lr.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.S.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.S.push(new So(Lr.keyField(),t))}}}return e.S}function xo(t){const e=cr(t);if(!e.D)if("F"===e.limitType)e.D=co(e.path,e.collectionGroup,Lo(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Lo(e)){const e="desc"===n.dir?"asc":"desc";t.push(new So(n.field,e))}const n=e.endAt?new To(e.endAt.position,!e.endAt.before):null,i=e.startAt?new To(e.startAt.position,!e.startAt.before):null;e.D=co(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}return e.D}function Oo(t,e){return uo(xo(t),xo(e))&&t.limitType===e.limitType}function Mo(t){return`${ho(xo(t))}|lt:${t.limitType}`}function Po(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${Xr(e.value)}`;var e})).join(", ")}]`),Br(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: "+Io(t.startAt)),t.endAt&&(e+=", endAt: "+Io(t.endAt)),`Target(${e})`}(xo(t))}; limitType=${t.limitType})`}function Fo(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Kr.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Co(t.startAt,Lo(t),e)||t.endAt&&Co(t.endAt,Lo(t),e))}(t,e)}function Vo(t){return(e,n)=>{let i=!1;for(const s of Lo(t)){const t=Uo(s,e,n);if(0!==t)return t;i=i||s.field.isKeyField()}return 0}}function Uo(t,e,n){const i=t.field.isKeyField()?Kr.comparator(e.key,n.key):function(t,e,n){const i=e.data.field(t),s=n.data.field(t);return null!==i&&null!==s?Wr(i,s):or()}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return or()}}function jo(t,e){if(t.C){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$r(e)?"-0":e}}function qo(t){return{integerValue:""+t}}function Bo(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!$r(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?qo(e):jo(t,e)}class $o{constructor(){this._=void 0}}function Ko(t,e,n){return t instanceof Go?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Wo?Qo(t,e):t instanceof Xo?Yo(t,e):function(t,e){const n=zo(t,e),i=Zo(n)+Zo(t.N);return Jr(n)&&Jr(t.N)?qo(i):jo(t.k,i)}(t,e)}function Ho(t,e,n){return t instanceof Wo?Qo(t,e):t instanceof Xo?Yo(t,e):n}function zo(t,e){return t instanceof Jo?Jr(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class Go extends $o{}class Wo extends $o{constructor(t){super(),this.elements=t}}function Qo(t,e){const n=ta(e);for(const e of t.elements)n.some((t=>zr(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Xo extends $o{constructor(t){super(),this.elements=t}}function Yo(t,e){let n=ta(e);for(const e of t.elements)n=n.filter((t=>!zr(t,e)));return{arrayValue:{values:n}}}class Jo extends $o{constructor(t,e){super(),this.k=t,this.N=e}}function Zo(t){return Fr(t.integerValue||t.doubleValue)}function ta(t){return Zr(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class ea{constructor(t,e){this.version=t,this.transformResults=e}}class na{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new na}static exists(t){return new na(void 0,t)}static updateTime(t){return new na(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function ia(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class sa{}function ra(t,e,n){t instanceof ua?function(t,e,n){const i=t.value.clone(),s=fa(t.fieldTransforms,e,n.transformResults);i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):t instanceof la?function(t,e,n){if(!ia(t.precondition,e))return void e.convertToUnknownDocument(n.version);const i=fa(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(da(t)),s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function oa(t,e,n){t instanceof ua?function(t,e,n){if(!ia(t.precondition,e))return;const i=t.value.clone(),s=pa(t.fieldTransforms,n,e);i.setAll(s),e.convertToFoundDocument(ha(e),i).setHasLocalMutations()}(t,e,n):t instanceof la?function(t,e,n){if(!ia(t.precondition,e))return;const i=pa(t.fieldTransforms,n,e),s=e.data;s.setAll(da(t)),s.setAll(i),e.convertToFoundDocument(ha(e),s).setHasLocalMutations()}(t,e,n):function(t,e){ia(t.precondition,e)&&e.convertToNoDocument(Ar.min())}(t,e)}function aa(t,e){let n=null;for(const i of t.fieldTransforms){const t=e.data.field(i.field),s=zo(i.transform,t||null);null!=s&&(null==n&&(n=so.empty()),n.set(i.field,s))}return n||null}function ca(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Ir(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Wo&&e instanceof Wo||t instanceof Xo&&e instanceof Xo?Ir(t.elements,e.elements,zr):t instanceof Jo&&e instanceof Jo?zr(t.N,e.N):t instanceof Go&&e instanceof Go}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function ha(t){return t.isFoundDocument()?t.version:Ar.min()}class ua extends sa{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}}class la extends sa{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}}function da(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}})),e}function fa(t,e,n){const i=new Map;ar(t.length===n.length);for(let s=0;s<n.length;s++){const r=t[s],o=r.transform,a=e.data.field(r.field);i.set(r.field,Ho(o,a,n[s]))}return i}function pa(t,e,n){const i=new Map;for(const s of t){const t=s.transform,r=n.data.field(s.field);i.set(s.field,Ko(t,r,e))}return i}class ga extends sa{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class ma extends sa{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}class ya{constructor(t){this.count=t}}var va,wa;function Ea(t){if(void 0===t)return ir("GRPC error has no .code"),hr.UNKNOWN;switch(t){case va.OK:return hr.OK;case va.CANCELLED:return hr.CANCELLED;case va.UNKNOWN:return hr.UNKNOWN;case va.DEADLINE_EXCEEDED:return hr.DEADLINE_EXCEEDED;case va.RESOURCE_EXHAUSTED:return hr.RESOURCE_EXHAUSTED;case va.INTERNAL:return hr.INTERNAL;case va.UNAVAILABLE:return hr.UNAVAILABLE;case va.UNAUTHENTICATED:return hr.UNAUTHENTICATED;case va.INVALID_ARGUMENT:return hr.INVALID_ARGUMENT;case va.NOT_FOUND:return hr.NOT_FOUND;case va.ALREADY_EXISTS:return hr.ALREADY_EXISTS;case va.PERMISSION_DENIED:return hr.PERMISSION_DENIED;case va.FAILED_PRECONDITION:return hr.FAILED_PRECONDITION;case va.ABORTED:return hr.ABORTED;case va.OUT_OF_RANGE:return hr.OUT_OF_RANGE;case va.UNIMPLEMENTED:return hr.UNIMPLEMENTED;case va.DATA_LOSS:return hr.DATA_LOSS;default:return or()}}(wa=va||(va={}))[wa.OK=0]="OK",wa[wa.CANCELLED=1]="CANCELLED",wa[wa.UNKNOWN=2]="UNKNOWN",wa[wa.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",wa[wa.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",wa[wa.NOT_FOUND=5]="NOT_FOUND",wa[wa.ALREADY_EXISTS=6]="ALREADY_EXISTS",wa[wa.PERMISSION_DENIED=7]="PERMISSION_DENIED",wa[wa.UNAUTHENTICATED=16]="UNAUTHENTICATED",wa[wa.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",wa[wa.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",wa[wa.ABORTED=10]="ABORTED",wa[wa.OUT_OF_RANGE=11]="OUT_OF_RANGE",wa[wa.UNIMPLEMENTED=12]="UNIMPLEMENTED",wa[wa.INTERNAL=13]="INTERNAL",wa[wa.UNAVAILABLE=14]="UNAVAILABLE",wa[wa.DATA_LOSS=15]="DATA_LOSS";class ba{constructor(t,e){this.comparator=t,this.root=e||Ia.EMPTY}insert(t,e){return new ba(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Ia.BLACK,null,null))}remove(t){return new ba(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ia.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ta(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ta(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ta(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ta(this.root,t,this.comparator,!0)}}class Ta{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Ia{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=null!=n?n:Ia.RED,this.left=null!=i?i:Ia.EMPTY,this.right=null!=s?s:Ia.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new Ia(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Ia.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return Ia.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Ia.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Ia.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw or();if(this.right.isRed())throw or();const t=this.left.check();if(t!==this.right.check())throw or();return t+(this.isRed()?0:1)}}Ia.EMPTY=null,Ia.RED=!0,Ia.BLACK=!1,Ia.EMPTY=new class{constructor(){this.size=0}get key(){throw or()}get value(){throw or()}get color(){throw or()}get left(){throw or()}get right(){throw or()}copy(t,e,n,i,s){return this}insert(t,e,n){return new Ia(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Sa{constructor(t){this.comparator=t,this.data=new ba(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Aa(this.data.getIterator())}getIteratorFrom(t){return new Aa(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Sa))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Sa(this.comparator);return e.data=t,e}}class Aa{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const Ca=new ba(Kr.comparator);function Da(){return Ca}const ka=new ba(Kr.comparator);function _a(){return ka}const Na=new ba(Kr.comparator);const Ra=new Sa(Kr.comparator);function La(...t){let e=Ra;for(const n of t)e=e.add(n);return e}const xa=new Sa(Tr);function Oa(){return xa}class Ma{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,Pa.createSynthesizedTargetChangeForCurrentChange(t,e)),new Ma(Ar.min(),n,Oa(),Da(),La())}}class Pa{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e){return new Pa(Or.EMPTY_BYTE_STRING,e,La(),La(),La())}}class Fa{constructor(t,e,n,i){this.$=t,this.removedTargetIds=e,this.key=n,this.F=i}}class Va{constructor(t,e){this.targetId=t,this.O=e}}class Ua{constructor(t,e,n=Or.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}}class ja{constructor(){this.M=0,this.L=$a(),this.B=Or.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.M}get j(){return this.q}W(t){t.approximateByteSize()>0&&(this.q=!0,this.B=t)}G(){let t=La(),e=La(),n=La();return this.L.forEach(((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:or()}})),new Pa(this.B,this.U,t,e,n)}H(){this.q=!1,this.L=$a()}J(t,e){this.q=!0,this.L=this.L.insert(t,e)}Y(t){this.q=!0,this.L=this.L.remove(t)}X(){this.M+=1}Z(){this.M-=1}tt(){this.q=!0,this.U=!0}}class qa{constructor(t){this.et=t,this.nt=new Map,this.st=Da(),this.it=Ba(),this.rt=new Sa(Tr)}ot(t){for(const e of t.$)t.F&&t.F.isFoundDocument()?this.at(e,t.F):this.ct(e,t.key,t.F);for(const e of t.removedTargetIds)this.ct(e,t.key,t.F)}ut(t){this.forEachTarget(t,(e=>{const n=this.ht(e);switch(t.state){case 0:this.lt(e)&&n.W(t.resumeToken);break;case 1:n.Z(),n.K||n.H(),n.W(t.resumeToken);break;case 2:n.Z(),n.K||this.removeTarget(e);break;case 3:this.lt(e)&&(n.tt(),n.W(t.resumeToken));break;case 4:this.lt(e)&&(this.ft(e),n.W(t.resumeToken));break;default:or()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.nt.forEach(((t,n)=>{this.lt(n)&&e(n)}))}dt(t){const e=t.targetId,n=t.O.count,i=this.wt(e);if(i){const t=i.target;if(lo(t))if(0===n){const n=new Kr(t.path);this.ct(e,n,oo.newNoDocument(n,Ar.min()))}else ar(1===n);else this._t(e)!==n&&(this.ft(e),this.rt=this.rt.add(e))}}gt(t){const e=new Map;this.nt.forEach(((n,i)=>{const s=this.wt(i);if(s){if(n.current&&lo(s.target)){const e=new Kr(s.target.path);null!==this.st.get(e)||this.yt(i,e)||this.ct(i,e,oo.newNoDocument(e,t))}n.j&&(e.set(i,n.G()),n.H())}}));let n=La();this.it.forEach(((t,e)=>{let i=!0;e.forEachWhile((t=>{const e=this.wt(t);return!e||2===e.purpose||(i=!1,!1)})),i&&(n=n.add(t))}));const i=new Ma(t,e,this.rt,this.st,n);return this.st=Da(),this.it=Ba(),this.rt=new Sa(Tr),i}at(t,e){if(!this.lt(t))return;const n=this.yt(t,e.key)?2:0;this.ht(t).J(e.key,n),this.st=this.st.insert(e.key,e),this.it=this.it.insert(e.key,this.Tt(e.key).add(t))}ct(t,e,n){if(!this.lt(t))return;const i=this.ht(t);this.yt(t,e)?i.J(e,1):i.Y(e),this.it=this.it.insert(e,this.Tt(e).delete(t)),n&&(this.st=this.st.insert(e,n))}removeTarget(t){this.nt.delete(t)}_t(t){const e=this.ht(t).G();return this.et.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}X(t){this.ht(t).X()}ht(t){let e=this.nt.get(t);return e||(e=new ja,this.nt.set(t,e)),e}Tt(t){let e=this.it.get(t);return e||(e=new Sa(Tr),this.it=this.it.insert(t,e)),e}lt(t){const e=null!==this.wt(t);return e||nr("WatchChangeAggregator","Detected inactive target",t),e}wt(t){const e=this.nt.get(t);return e&&e.K?null:this.et.Et(t)}ft(t){this.nt.set(t,new ja),this.et.getRemoteKeysForTarget(t).forEach((e=>{this.ct(t,e,null)}))}yt(t,e){return this.et.getRemoteKeysForTarget(t).has(e)}}function Ba(){return new ba(Kr.comparator)}function $a(){return new ba(Kr.comparator)}const Ka={asc:"ASCENDING",desc:"DESCENDING"},Ha={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class za{constructor(t,e){this.databaseId=t,this.C=e}}function Ga(t,e){return t.C?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Wa(t,e){return t.C?e.toBase64():e.toUint8Array()}function Qa(t,e){return Ga(t,e.toTimestamp())}function Xa(t){return ar(!!t),Ar.fromTimestamp(function(t){const e=Pr(t);return new Sr(e.seconds,e.nanos)}(t))}function Ya(t,e){return function(t){return new Nr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Ja(t){const e=Nr.fromString(t);return ar(vc(e)),e}function Za(t,e){return Ya(t.databaseId,e.path)}function tc(t,e){const n=Ja(e);if(n.get(1)!==t.databaseId.projectId)throw new ur(hr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ur(hr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Kr(ic(n))}function ec(t,e){return Ya(t.databaseId,e)}function nc(t){return new Nr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ic(t){return ar(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function sc(t,e,n){return{name:Za(t,e),fields:n.value.mapValue.fields}}function rc(t,e){return{documents:[ec(t,e.path)]}}function oc(t,e){const n={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(n.parent=ec(t,i),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ec(t,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const s=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(eo(t.value))return{unaryFilter:{field:fc(t.field),op:"IS_NAN"}};if(to(t.value))return{unaryFilter:{field:fc(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(eo(t.value))return{unaryFilter:{field:fc(t.field),op:"IS_NOT_NAN"}};if(to(t.value))return{unaryFilter:{field:fc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fc(t.field),op:dc(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);s&&(n.structuredQuery.where=s);const r=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:fc(t.field),direction:lc(t.dir)}}(t)))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.C||Br(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=hc(e.startAt)),e.endAt&&(n.structuredQuery.endAt=hc(e.endAt)),n}function ac(t){let e=function(t){const e=Ja(t);return 4===e.length?Nr.emptyPath():ic(e)}(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){ar(1===i);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=cc(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new So(pc(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Br(e)?null:e}(n.limit));let c=null;n.startAt&&(c=uc(n.startAt));let h=null;return n.endAt&&(h=uc(n.endAt)),function(t,e,n,i,s,r,o,a){return new ko(t,e,n,i,s,r,o,a)}(e,s,o,r,a,"F",c,h)}function cc(t){return t?void 0!==t.unaryFilter?[mc(t)]:void 0!==t.fieldFilter?[gc(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>cc(t))).reduce(((t,e)=>t.concat(e))):or():[]}function hc(t){return{before:t.before,values:t.position}}function uc(t){const e=!!t.before,n=t.values||[];return new To(n,e)}function lc(t){return Ka[t]}function dc(t){return Ha[t]}function fc(t){return{fieldPath:t.canonicalString()}}function pc(t){return Lr.fromServerFormat(t.fieldPath)}function gc(t){return fo.create(pc(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return or()}}(t.fieldFilter.op),t.fieldFilter.value)}function mc(t){switch(t.unaryFilter.op){case"IS_NAN":const e=pc(t.unaryFilter.field);return fo.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=pc(t.unaryFilter.field);return fo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=pc(t.unaryFilter.field);return fo.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=pc(t.unaryFilter.field);return fo.create(s,"!=",{nullValue:"NULL_VALUE"});default:return or()}}function yc(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function vc(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function wc(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=bc(e)),e=Ec(t.get(n),e);return bc(e)}function Ec(t,e){let n=e;const i=t.length;for(let e=0;e<i;e++){const i=t.charAt(e);switch(i){case"\0":n+="";break;case"":n+="";break;default:n+=i}}return n}function bc(t){return t+""}class Tc{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}Tc.store="owner",Tc.key="owner";class Ic{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}Ic.store="mutationQueues",Ic.keyPath="userId";class Sc{constructor(t,e,n,i,s){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=i,this.mutations=s}}Sc.store="mutations",Sc.keyPath="batchId",Sc.userMutationsIndex="userMutationsIndex",Sc.userMutationsKeyPath=["userId","batchId"];class Ac{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,wc(e)]}static key(t,e,n){return[t,wc(e),n]}}Ac.store="documentMutations",Ac.PLACEHOLDER=new Ac;class Cc{constructor(t,e,n,i,s,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=i,this.readTime=s,this.parentPath=r}}Cc.store="remoteDocuments",Cc.readTimeIndex="readTimeIndex",Cc.readTimeIndexPath="readTime",Cc.collectionReadTimeIndex="collectionReadTimeIndex",Cc.collectionReadTimeIndexPath=["parentPath","readTime"];class Dc{constructor(t){this.byteSize=t}}Dc.store="remoteDocumentGlobal",Dc.key="remoteDocumentGlobalKey";class kc{constructor(t,e,n,i,s,r,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=i,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=r,this.query=o}}kc.store="targets",kc.keyPath="targetId",kc.queryTargetsIndexName="queryTargetsIndex",kc.queryTargetsKeyPath=["canonicalId","targetId"];class _c{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}_c.store="targetDocuments",_c.keyPath=["targetId","path"],_c.documentTargetsIndex="documentTargetsIndex",_c.documentTargetsKeyPath=["path","targetId"];class Nc{constructor(t,e,n,i){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=i}}Nc.key="targetGlobalKey",Nc.store="targetGlobal";class Rc{constructor(t,e){this.collectionId=t,this.parent=e}}Rc.store="collectionParents",Rc.keyPath=["collectionId","parent"];class Lc{constructor(t,e,n,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=i}}Lc.store="clientMetadata",Lc.keyPath="clientId";class xc{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}xc.store="bundles",xc.keyPath="bundleId";class Oc{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}Oc.store="namedQueries",Oc.keyPath="name",Ic.store,Sc.store,Ac.store,Cc.store,kc.store,Tc.store,Nc.store,_c.store,Lc.store,Dc.store,Rc.store,xc.store,Oc.store;class Mc{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&or(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Mc(((n,i)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,i)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,i)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Mc?e:Mc.resolve(e)}catch(t){return Mc.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Mc.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Mc.reject(e)}static resolve(t){return new Mc(((e,n)=>{e(t)}))}static reject(t){return new Mc(((e,n)=>{n(t)}))}static waitFor(t){return new Mc(((e,n)=>{let i=0,s=0,r=!1;t.forEach((t=>{++i,t.next((()=>{++s,r&&s===i&&e()}),(t=>n(t)))})),r=!0,s===i&&e()}))}static or(t){let e=Mc.resolve(!1);for(const n of t)e=e.next((t=>t?Mc.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,i)=>{n.push(e.call(this,t,i))})),this.waitFor(n)}}function Pc(t){return"IndexedDbTransactionError"===t.name}class Fc{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const i=this.mutations[e];i.key.isEqual(t.key)&&ra(i,t,n[e])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&oa(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&oa(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach((e=>{const n=t.get(e.key),i=n;this.applyToLocalView(i),n.isValidDocument()||i.convertToNoDocument(Ar.min())}))}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),La())}isEqual(t){return this.batchId===t.batchId&&Ir(this.mutations,t.mutations,((t,e)=>ca(t,e)))&&Ir(this.baseMutations,t.baseMutations,((t,e)=>ca(t,e)))}}class Vc{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){ar(t.mutations.length===n.length);let i=Na;const s=t.mutations;for(let t=0;t<s.length;t++)i=i.insert(s[t].key,n[t].version);return new Vc(t,e,n,i)}}class Uc{constructor(t,e,n,i,s=Ar.min(),r=Ar.min(),o=Or.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}withSequenceNumber(t){return new Uc(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new Uc(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new Uc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class jc{constructor(t){this.Gt=t}}function qc(t){const e=ac({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?function(t,e,n){return new ko(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(e,e.limit,"L"):e}class Bc{constructor(){this.zt=new $c}addToCollectionParentIndex(t,e){return this.zt.add(e),Mc.resolve()}getCollectionParents(t,e){return Mc.resolve(this.zt.getEntries(e))}}class $c{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new Sa(Nr.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new Sa(Nr.comparator)).toArray()}}class Kc{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Kc(t,Kc.DEFAULT_COLLECTION_PERCENTILE,Kc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Kc.DEFAULT_COLLECTION_PERCENTILE=10,Kc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Kc.DEFAULT=new Kc(41943040,Kc.DEFAULT_COLLECTION_PERCENTILE,Kc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Kc.DISABLED=new Kc(-1,0,0);class Hc{constructor(t){this.se=t}next(){return this.se+=2,this.se}static ie(){return new Hc(0)}static re(){return new Hc(-1)}}async function zc(t){if(t.code!==hr.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;nr("LocalStore","Unexpectedly lost primary lease")}class Gc{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,i]of n)if(this.equalsFn(e,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0!==i){for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return void(i[n]=[t,e]);i.push([t,e])}else this.inner[n]=[[t,e]]}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),!0;return!1}forEach(t){Dr(this.inner,((e,n)=>{for(const[e,i]of n)t(e,i)}))}isEmpty(){return kr(this.inner)}}class Wc{constructor(t,e,n){this.Je=t,this.An=e,this.Jt=n}Rn(t,e){return this.An.getAllMutationBatchesAffectingDocumentKey(t,e).next((n=>this.Pn(t,e,n)))}Pn(t,e,n){return this.Je.getEntry(t,e).next((t=>{for(const e of n)e.applyToLocalView(t);return t}))}bn(t,e){t.forEach(((t,n)=>{for(const t of e)t.applyToLocalView(n)}))}vn(t,e){return this.Je.getEntries(t,e).next((e=>this.Vn(t,e).next((()=>e))))}Vn(t,e){return this.An.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>this.bn(e,t)))}getDocumentsMatchingQuery(t,e,n){return function(t){return Kr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Sn(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.Dn(t,e,n):this.Cn(t,e,n)}Sn(t,e){return this.Rn(t,new Kr(e)).next((t=>{let e=_a();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}Dn(t,e,n){const i=e.collectionGroup;let s=_a();return this.Jt.getCollectionParents(t,i).next((r=>Mc.forEach(r,(r=>{const o=function(t,e){return new ko(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(i));return this.Cn(t,o,n).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}Cn(t,e,n){let i,s;return this.Je.getDocumentsMatchingQuery(t,e,n).next((n=>(i=n,this.An.getAllMutationBatchesAffectingQuery(t,e)))).next((e=>(s=e,this.Nn(t,s,i).next((t=>{i=t;for(const t of s)for(const e of t.mutations){const n=e.key;let s=i.get(n);null==s&&(s=oo.newInvalidDocument(n),i=i.insert(n,s)),oa(e,s,t.localWriteTime),s.isFoundDocument()||(i=i.remove(n))}}))))).next((()=>(i.forEach(((t,n)=>{Fo(e,n)||(i=i.remove(t))})),i)))}Nn(t,e,n){let i=La();for(const t of e)for(const e of t.mutations)e instanceof la&&null===n.get(e.key)&&(i=i.add(e.key));let s=n;return this.Je.getEntries(t,i).next((t=>(t.forEach(((t,e)=>{e.isFoundDocument()&&(s=s.insert(t,e))})),s)))}}class Qc{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.kn=n,this.xn=i}static $n(t,e){let n=La(),i=La();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:i=i.add(t.doc.key)}return new Qc(t,e.fromCache,n,i)}}class Xc{Fn(t){this.On=t}getDocumentsMatchingQuery(t,e,n,i){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Ar.min())?this.Mn(t,e):this.On.vn(t,i).next((s=>{const r=this.Ln(e,s);return(No(e)||Ro(e))&&this.Bn(e.limitType,r,i,n)?this.Mn(t,e):(er()<=m.DEBUG&&nr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Po(e)),this.On.getDocumentsMatchingQuery(t,e,n).next((t=>(r.forEach((e=>{t=t.insert(e.key,e)})),t))))}))}Ln(t,e){let n=new Sa(Vo(t));return e.forEach(((e,i)=>{Fo(t,i)&&(n=n.add(i))})),n}Bn(t,e,n,i){if(n.size!==e.size)return!0;const s="F"===t?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Mn(t,e){return er()<=m.DEBUG&&nr("QueryEngine","Using full collection scan to execute query:",Po(e)),this.On.getDocumentsMatchingQuery(t,e,Ar.min())}}class Yc{constructor(t,e,n,i){this.persistence=t,this.Un=e,this.k=i,this.qn=new ba(Tr),this.Kn=new Gc((t=>ho(t)),uo),this.jn=Ar.min(),this.An=t.getMutationQueue(n),this.Qn=t.getRemoteDocumentCache(),this.He=t.getTargetCache(),this.Wn=new Wc(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=t.getBundleCache(),this.Un.Fn(this.Wn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.qn)))}}async function Jc(t,e){const n=cr(t);let i=n.An,s=n.Wn;const r=await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.An.getAllMutationBatches(t).next((o=>(r=o,i=n.persistence.getMutationQueue(e),s=new Wc(n.Qn,i,n.persistence.getIndexManager()),i.getAllMutationBatches(t)))).next((e=>{const n=[],i=[];let o=La();for(const t of r){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return s.vn(t,o).next((t=>({Gn:t,removedBatchIds:n,addedBatchIds:i})))}))}));return n.An=i,n.Wn=s,n.Un.Fn(n.Wn),r}function Zc(t){const e=cr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.He.getLastRemoteSnapshotVersion(t)))}function th(t,e){const n=cr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.An.getNextMutationBatchAfterBatchId(t,e))))}async function eh(t,e,n){const i=cr(t),s=i.qn.get(e),r=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",r,(t=>i.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!Pc(t))throw t;nr("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}i.qn=i.qn.remove(e),i.Kn.delete(s.target)}function nh(t,e,n){const i=cr(t);let s=Ar.min(),r=La();return i.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const i=cr(t),s=i.Kn.get(n);return void 0!==s?Mc.resolve(i.qn.get(s)):i.He.getTargetData(e,n)}(i,t,xo(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.He.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>i.Un.getDocumentsMatchingQuery(t,e,n?s:Ar.min(),n?r:La()))).next((t=>({documents:t,zn:r})))))}class ih{constructor(t){this.k=t,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(t,e){return Mc.resolve(this.Xn.get(e))}saveBundleMetadata(t,e){var n;return this.Xn.set(e.id,{id:(n=e).id,version:n.version,createTime:Xa(n.createTime)}),Mc.resolve()}getNamedQuery(t,e){return Mc.resolve(this.Zn.get(e))}saveNamedQuery(t,e){return this.Zn.set(e.name,function(t){return{name:t.name,query:qc(t.bundledQuery),readTime:Xa(t.readTime)}}(e)),Mc.resolve()}}class sh{constructor(){this.ts=new Sa(rh.es),this.ns=new Sa(rh.ss)}isEmpty(){return this.ts.isEmpty()}addReference(t,e){const n=new rh(t,e);this.ts=this.ts.add(n),this.ns=this.ns.add(n)}rs(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.os(new rh(t,e))}cs(t,e){t.forEach((t=>this.removeReference(t,e)))}us(t){const e=new Kr(new Nr([])),n=new rh(e,t),i=new rh(e,t+1),s=[];return this.ns.forEachInRange([n,i],(t=>{this.os(t),s.push(t.key)})),s}hs(){this.ts.forEach((t=>this.os(t)))}os(t){this.ts=this.ts.delete(t),this.ns=this.ns.delete(t)}ls(t){const e=new Kr(new Nr([])),n=new rh(e,t),i=new rh(e,t+1);let s=La();return this.ns.forEachInRange([n,i],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new rh(t,0),n=this.ts.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class rh{constructor(t,e){this.key=t,this.fs=e}static es(t,e){return Kr.comparator(t.key,e.key)||Tr(t.fs,e.fs)}static ss(t,e){return Tr(t.fs,e.fs)||Kr.comparator(t.key,e.key)}}class oh{constructor(t,e){this.Jt=t,this.referenceDelegate=e,this.An=[],this.ds=1,this.ws=new Sa(rh.es)}checkEmpty(t){return Mc.resolve(0===this.An.length)}addMutationBatch(t,e,n,i){const s=this.ds;this.ds++,this.An.length>0&&this.An[this.An.length-1];const r=new Fc(s,e,n,i);this.An.push(r);for(const e of i)this.ws=this.ws.add(new rh(e.key,s)),this.Jt.addToCollectionParentIndex(t,e.key.path.popLast());return Mc.resolve(r)}lookupMutationBatch(t,e){return Mc.resolve(this._s(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.gs(n),s=i<0?0:i;return Mc.resolve(this.An.length>s?this.An[s]:null)}getHighestUnacknowledgedBatchId(){return Mc.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(t){return Mc.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new rh(e,0),i=new rh(e,Number.POSITIVE_INFINITY),s=[];return this.ws.forEachInRange([n,i],(t=>{const e=this._s(t.fs);s.push(e)})),Mc.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Sa(Tr);return e.forEach((t=>{const e=new rh(t,0),i=new rh(t,Number.POSITIVE_INFINITY);this.ws.forEachInRange([e,i],(t=>{n=n.add(t.fs)}))})),Mc.resolve(this.ys(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let s=n;Kr.isDocumentKey(s)||(s=s.child(""));const r=new rh(new Kr(s),0);let o=new Sa(Tr);return this.ws.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===i&&(o=o.add(t.fs)),!0)}),r),Mc.resolve(this.ys(o))}ys(t){const e=[];return t.forEach((t=>{const n=this._s(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){ar(0===this.ps(e.batchId,"removed")),this.An.shift();let n=this.ws;return Mc.forEach(e.mutations,(i=>{const s=new rh(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((()=>{this.ws=n}))}ee(t){}containsKey(t,e){const n=new rh(e,0),i=this.ws.firstAfterOrEqual(n);return Mc.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.An.length,Mc.resolve()}ps(t,e){return this.gs(t)}gs(t){return 0===this.An.length?0:t-this.An[0].batchId}_s(t){const e=this.gs(t);return e<0||e>=this.An.length?null:this.An[e]}}class ah{constructor(t,e){this.Jt=t,this.Ts=e,this.docs=new ba(Kr.comparator),this.size=0}addEntry(t,e,n){const i=e.key,s=this.docs.get(i),r=s?s.size:0,o=this.Ts(e);return this.docs=this.docs.insert(i,{document:e.clone(),size:o,readTime:n}),this.size+=o-r,this.Jt.addToCollectionParentIndex(t,i.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Mc.resolve(n?n.document.clone():oo.newInvalidDocument(e))}getEntries(t,e){let n=Da();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.clone():oo.newInvalidDocument(t))})),Mc.resolve(n)}getDocumentsMatchingQuery(t,e,n){let i=Da();const s=new Kr(e.path.child("")),r=this.docs.getIteratorFrom(s);for(;r.hasNext();){const{key:t,value:{document:s,readTime:o}}=r.getNext();if(!e.path.isPrefixOf(t.path))break;o.compareTo(n)<=0||Fo(e,s)&&(i=i.insert(s.key,s.clone()))}return Mc.resolve(i)}Es(t,e){return Mc.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new ch(this)}getSize(t){return Mc.resolve(this.size)}}class ch extends class{constructor(){this.changes=new Gc((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}getReadTime(t){const e=this.changes.get(t);return e?e.readTime:Ar.min()}addEntry(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})}removeEntry(t,e=null){this.assertNotApplied(),this.changes.set(t,{document:oo.newInvalidDocument(t),readTime:e})}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Mc.resolve(n.document):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}{constructor(t){super(),this.De=t}applyChanges(t){const e=[];return this.changes.forEach(((n,i)=>{i.document.isValidDocument()?e.push(this.De.addEntry(t,i.document,this.getReadTime(n))):this.De.removeEntry(n)})),Mc.waitFor(e)}getFromCache(t,e){return this.De.getEntry(t,e)}getAllFromCache(t,e){return this.De.getEntries(t,e)}}class hh{constructor(t){this.persistence=t,this.Is=new Gc((t=>ho(t)),uo),this.lastRemoteSnapshotVersion=Ar.min(),this.highestTargetId=0,this.As=0,this.Rs=new sh,this.targetCount=0,this.Ps=Hc.ie()}forEachTarget(t,e){return this.Is.forEach(((t,n)=>e(n))),Mc.resolve()}getLastRemoteSnapshotVersion(t){return Mc.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Mc.resolve(this.As)}allocateTargetId(t){return this.highestTargetId=this.Ps.next(),Mc.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.As&&(this.As=e),Mc.resolve()}ce(t){this.Is.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Ps=new Hc(e),this.highestTargetId=e),t.sequenceNumber>this.As&&(this.As=t.sequenceNumber)}addTargetData(t,e){return this.ce(e),this.targetCount+=1,Mc.resolve()}updateTargetData(t,e){return this.ce(e),Mc.resolve()}removeTargetData(t,e){return this.Is.delete(e.target),this.Rs.us(e.targetId),this.targetCount-=1,Mc.resolve()}removeTargets(t,e,n){let i=0;const s=[];return this.Is.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Is.delete(r),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),i++)})),Mc.waitFor(s).next((()=>i))}getTargetCount(t){return Mc.resolve(this.targetCount)}getTargetData(t,e){const n=this.Is.get(e)||null;return Mc.resolve(n)}addMatchingKeys(t,e,n){return this.Rs.rs(e,n),Mc.resolve()}removeMatchingKeys(t,e,n){this.Rs.cs(e,n);const i=this.persistence.referenceDelegate,s=[];return i&&e.forEach((e=>{s.push(i.markPotentiallyOrphaned(t,e))})),Mc.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Rs.us(e),Mc.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Rs.ls(e);return Mc.resolve(n)}containsKey(t,e){return Mc.resolve(this.Rs.containsKey(e))}}class uh{constructor(t,e){this.bs={},this.Be=new wr(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=t(this),this.He=new hh(this),this.Jt=new Bc,this.Je=function(t,e){return new ah(t,e)}(this.Jt,(t=>this.referenceDelegate.vs(t))),this.k=new jc(e),this.Ye=new ih(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(t){let e=this.bs[t.toKey()];return e||(e=new oh(this.Jt,this.referenceDelegate),this.bs[t.toKey()]=e),e}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(t,e,n){nr("MemoryPersistence","Starting transaction:",t);const i=new lh(this.Be.next());return this.referenceDelegate.Vs(),n(i).next((t=>this.referenceDelegate.Ss(i).next((()=>t)))).toPromise().then((t=>(i.raiseOnCommittedEvent(),t)))}Ds(t,e){return Mc.or(Object.values(this.bs).map((n=>()=>n.containsKey(t,e))))}}class lh extends class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}{constructor(t){super(),this.currentSequenceNumber=t}}class dh{constructor(t){this.persistence=t,this.Cs=new sh,this.Ns=null}static ks(t){return new dh(t)}get xs(){if(this.Ns)return this.Ns;throw or()}addReference(t,e,n){return this.Cs.addReference(n,e),this.xs.delete(n.toString()),Mc.resolve()}removeReference(t,e,n){return this.Cs.removeReference(n,e),this.xs.add(n.toString()),Mc.resolve()}markPotentiallyOrphaned(t,e){return this.xs.add(e.toString()),Mc.resolve()}removeTarget(t,e){this.Cs.us(e.targetId).forEach((t=>this.xs.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.xs.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Vs(){this.Ns=new Set}Ss(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Mc.forEach(this.xs,(n=>{const i=Kr.fromPath(n);return this.$s(t,i).next((t=>{t||e.removeEntry(i)}))})).next((()=>(this.Ns=null,e.apply(t))))}updateLimboDocument(t,e){return this.$s(t,e).next((t=>{t?this.xs.delete(e.toString()):this.xs.add(e.toString())}))}vs(t){return 0}$s(t,e){return Mc.or([()=>Mc.resolve(this.Cs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ds(t,e)])}}class fh{constructor(){this.activeTargetIds=Oa()}Ms(t){this.activeTargetIds=this.activeTargetIds.add(t)}Ls(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Os(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class ph{constructor(){this.pi=new fh,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.pi.Ms(t),this.Ti[t]||"not-current"}updateQueryState(t,e,n){this.Ti[t]=e}removeLocalQueryTarget(t){this.pi.Ls(t)}isLocalQueryTarget(t){return this.pi.activeTargetIds.has(t)}clearQueryState(t){delete this.Ti[t]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(t){return this.pi.activeTargetIds.has(t)}start(){return this.pi=new fh,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(){}}class gh{Ei(t){}shutdown(){}}class mh{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.Pi(),this.bi=[],this.vi()}Ei(t){this.bi.push(t)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){nr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.bi)t(0)}Pi(){nr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.bi)t(1)}static bt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const yh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class vh{constructor(t){this.Vi=t.Vi,this.Si=t.Si}Di(t){this.Ci=t}Ni(t){this.ki=t}onMessage(t){this.xi=t}close(){this.Si()}send(t){this.Vi(t)}$i(){this.Ci()}Fi(t){this.ki(t)}Oi(t){this.xi(t)}}class wh extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.Mi=e+"://"+t.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(t,e,n,i,s){const r=this.Ui(t,e);nr("RestConnection","Sending: ",r,n);const o={};return this.qi(o,i,s),this.Ki(t,r,o,n).then((t=>(nr("RestConnection","Received: ",t),t)),(e=>{throw sr("RestConnection",`${t} failed with error: `,e,"url: ",r,"request:",n),e}))}ji(t,e,n,i,s){return this.Bi(t,e,n,i,s)}qi(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Zs,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}Ui(t,e){const n=yh[t];return`${this.Mi}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}Ki(t,e,n,i){return new Promise(((s,r)=>{const o=new Xs;o.listenOnce(Hs.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case Ks.NO_ERROR:const e=o.getResponseJson();nr("Connection","XHR received:",JSON.stringify(e)),s(e);break;case Ks.TIMEOUT:nr("Connection",'RPC "'+t+'" timed out'),r(new ur(hr.DEADLINE_EXCEEDED,"Request time out"));break;case Ks.HTTP_ERROR:const n=o.getStatus();if(nr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(hr).indexOf(e)>=0?e:hr.UNKNOWN}(t.status);r(new ur(e,t.message))}else r(new ur(hr.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new ur(hr.UNAVAILABLE,"Connection failed."));break;default:or()}}finally{nr("Connection",'RPC "'+t+'" completed.')}}));const a=JSON.stringify(i);o.send(e,"POST",a,n,15)}))}Qi(t,n,s){const r=[this.Mi,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Bs(),a=$s(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(c.xmlHttpFactory=new Ws({})),this.qi(c.initMessageHeaders,n,s),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(e())||"object"==typeof navigator&&"ReactNative"===navigator.product||e().indexOf("Electron/")>=0||function(){const t=e();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}()||e().indexOf("MSAppHost/")>=0||i()||(c.httpHeadersOverwriteParam="$httpHeaders");const h=r.join("");nr("Connection","Creating WebChannel: "+h,c);const u=o.createWebChannel(h,c);let l=!1,d=!1;const f=new vh({Vi:t=>{d?nr("Connection","Not sending because WebChannel is closed:",t):(l||(nr("Connection","Opening WebChannel transport."),u.open(),l=!0),nr("Connection","WebChannel sending:",t),u.send(t))},Si:()=>u.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(u,Qs.EventType.OPEN,(()=>{d||nr("Connection","WebChannel transport opened.")})),p(u,Qs.EventType.CLOSE,(()=>{d||(d=!0,nr("Connection","WebChannel transport closed"),f.Fi())})),p(u,Qs.EventType.ERROR,(t=>{d||(d=!0,sr("Connection","WebChannel transport errored:",t),f.Fi(new ur(hr.UNAVAILABLE,"The operation could not be completed")))})),p(u,Qs.EventType.MESSAGE,(t=>{var e;if(!d){const n=t.data[0];ar(!!n);const i=n,s=i.error||(null===(e=i[0])||void 0===e?void 0:e.error);if(s){nr("Connection","WebChannel received error:",s);const t=s.status;let e=function(t){const e=va[t];if(void 0!==e)return Ea(e)}(t),n=s.message;void 0===e&&(e=hr.INTERNAL,n="Unknown error status: "+t+" with message "+s.message),d=!0,f.Fi(new ur(e,n)),u.close()}else nr("Connection","WebChannel received:",n),f.Oi(n)}})),p(a,zs.STAT_EVENT,(t=>{t.stat===Gs.PROXY?nr("Connection","Detected buffering proxy"):t.stat===Gs.NOPROXY&&nr("Connection","Detected no buffering proxy")})),setTimeout((()=>{f.$i()}),0),f}}function Eh(){return"undefined"!=typeof document?document:null}function bh(t){return new za(t,!0)}class Th{constructor(t,e,n=1e3,i=1.5,s=6e4){this.Oe=t,this.timerId=e,this.Wi=n,this.Gi=i,this.zi=s,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(t){this.cancel();const e=Math.floor(this.Hi+this.tr()),n=Math.max(0,Date.now()-this.Yi),i=Math.max(0,e-n);i>0&&nr("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Hi} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Ji=this.Oe.enqueueAfterDelay(this.timerId,i,(()=>(this.Yi=Date.now(),t()))),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}class Ih{constructor(t,e,n,i,s,r,o,a){this.Oe=t,this.nr=n,this.sr=i,this.ir=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.rr=0,this.ar=null,this.cr=null,this.stream=null,this.ur=new Th(t,e)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}async stop(){this.hr()&&await this.close(0)}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&null===this.ar&&(this.ar=this.Oe.enqueueAfterDelay(this.nr,6e4,(()=>this.mr())))}gr(t){this.yr(),this.stream.send(t)}async mr(){if(this.lr())return this.close(0)}yr(){this.ar&&(this.ar.cancel(),this.ar=null)}pr(){this.cr&&(this.cr.cancel(),this.cr=null)}async close(t,e){this.yr(),this.pr(),this.ur.cancel(),this.rr++,4!==t?this.ur.reset():e&&e.code===hr.RESOURCE_EXHAUSTED?(ir(e.toString()),ir("Using maximum backoff delay to prevent overloading the backend."),this.ur.Xi()):e&&e.code===hr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Tr(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Ni(e)}Tr(){}auth(){this.state=1;const t=this.Er(this.rr),e=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.rr===e&&this.Ir(t,n)}),(e=>{t((()=>{const t=new ur(hr.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Ar(t)}))}))}Ir(t,e){const n=this.Er(this.rr);this.stream=this.Rr(t,e),this.stream.Di((()=>{n((()=>(this.state=2,this.cr=this.Oe.enqueueAfterDelay(this.sr,1e4,(()=>(this.lr()&&(this.state=3),Promise.resolve()))),this.listener.Di())))})),this.stream.Ni((t=>{n((()=>this.Ar(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}dr(){this.state=5,this.ur.Zi((async()=>{this.state=0,this.start()}))}Ar(t){return nr("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Er(t){return e=>{this.Oe.enqueueAndForget((()=>this.rr===t?e():(nr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Sh extends Ih{constructor(t,e,n,i,s,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,r),this.k=s}Rr(t,e){return this.ir.Qi("Listen",t,e)}onMessage(t){this.ur.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const i=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:or()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],r=function(t,e){return t.C?(ar(void 0===e||"string"==typeof e),Or.fromBase64String(e||"")):(ar(void 0===e||e instanceof Uint8Array),Or.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?hr.UNKNOWN:Ea(t.code);return new ur(e,t.message||"")}(o);n=new Ua(i,s,r,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const s=tc(t,i.document.name),r=Xa(i.document.updateTime),o=new so({mapValue:{fields:i.document.fields}}),a=oo.newFoundDocument(s,r,o),c=i.targetIds||[],h=i.removedTargetIds||[];n=new Fa(c,h,a.key,a)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const s=tc(t,i.document),r=i.readTime?Xa(i.readTime):Ar.min(),o=oo.newNoDocument(s,r),a=i.removedTargetIds||[];n=new Fa([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const s=tc(t,i.document),r=i.removedTargetIds||[];n=new Fa([],r,s,null)}else{if(!("filter"in e))return or();{e.filter;const t=e.filter;t.targetId;const i=t.count||0,s=new ya(i),r=t.targetId;n=new Va(r,s)}}return n}(this.k,t),n=function(t){if(!("targetChange"in t))return Ar.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Ar.min():e.readTime?Xa(e.readTime):Ar.min()}(t);return this.listener.Pr(e,n)}br(t){const e={};e.database=nc(this.k),e.addTarget=function(t,e){let n;const i=e.target;return n=lo(i)?{documents:rc(t,i)}:{query:oc(t,i)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Wa(t,e.resumeToken):e.snapshotVersion.compareTo(Ar.min())>0&&(n.readTime=Ga(t,e.snapshotVersion.toTimestamp())),n}(this.k,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return or()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.k,t);n&&(e.labels=n),this.gr(e)}vr(t){const e={};e.database=nc(this.k),e.removeTarget=t,this.gr(e)}}class Ah extends Ih{constructor(t,e,n,i,s,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,r),this.k=s,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(t,e){return this.ir.Qi("Write",t,e)}onMessage(t){if(ar(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Vr){this.ur.reset();const e=function(t,e){return t&&t.length>0?(ar(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Xa(t.updateTime):Xa(e);return n.isEqual(Ar.min())&&(n=Xa(e)),new ea(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Xa(t.commitTime);return this.listener.Cr(n,e)}return ar(!t.writeResults||0===t.writeResults.length),this.Vr=!0,this.listener.Nr()}kr(){const t={};t.database=nc(this.k),this.gr(t)}Dr(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof ua)n={update:sc(t,e.key,e.value)};else if(e instanceof ga)n={delete:Za(t,e.key)};else if(e instanceof la)n={update:sc(t,e.key,e.data),updateMask:yc(e.fieldMask)};else{if(!(e instanceof ma))return or();n={verify:Za(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Go)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Wo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Xo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Jo)return{fieldPath:e.field.canonicalString(),increment:n.N};throw or()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Qa(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:or()}(t,e.precondition)),n}(this.k,t)))};this.gr(e)}}class Ch extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.ir=n,this.k=i,this.$r=!1}Fr(){if(this.$r)throw new ur(hr.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(t,e,n){return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.ir.Bi(t,e,n,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===hr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new ur(hr.UNKNOWN,t.toString())}))}ji(t,e,n){return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.ir.ji(t,e,n,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===hr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new ur(hr.UNKNOWN,t.toString())}))}terminate(){this.$r=!0}}class Dh{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.Or=0,this.Mr=null,this.Lr=!0}Br(){0===this.Or&&(this.Ur("Unknown"),this.Mr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.Mr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve()))))}Kr(t){"Online"===this.state?this.Ur("Unknown"):(this.Or++,this.Or>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.Ur("Offline")))}set(t){this.jr(),this.Or=0,"Online"===t&&(this.Lr=!1),this.Ur(t)}Ur(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}qr(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(ir(e),this.Lr=!1):nr("OnlineStateTracker",e)}jr(){null!==this.Mr&&(this.Mr.cancel(),this.Mr=null)}}class kh{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=s,this.Hr.Ei((t=>{n.enqueueAndForget((async()=>{Fh(this)&&(nr("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=cr(t);e.Gr.add(4),await Nh(e),e.Jr.set("Unknown"),e.Gr.delete(4),await _h(e)}(this))}))})),this.Jr=new Dh(n,i)}}async function _h(t){if(Fh(t))for(const e of t.zr)await e(!0)}async function Nh(t){for(const e of t.zr)await e(!1)}function Rh(t,e){const n=cr(t);n.Wr.has(e.targetId)||(n.Wr.set(e.targetId,e),Ph(n)?Mh(n):Zh(n).lr()&&xh(n,e))}function Lh(t,e){const n=cr(t),i=Zh(n);n.Wr.delete(e),i.lr()&&Oh(n,e),0===n.Wr.size&&(i.lr()?i._r():Fh(n)&&n.Jr.set("Unknown"))}function xh(t,e){t.Yr.X(e.targetId),Zh(t).br(e)}function Oh(t,e){t.Yr.X(e),Zh(t).vr(e)}function Mh(t){t.Yr=new qa({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>t.Wr.get(e)||null}),Zh(t).start(),t.Jr.Br()}function Ph(t){return Fh(t)&&!Zh(t).hr()&&t.Wr.size>0}function Fh(t){return 0===cr(t).Gr.size}function Vh(t){t.Yr=void 0}async function Uh(t){t.Wr.forEach(((e,n)=>{xh(t,e)}))}async function jh(t,e){Vh(t),Ph(t)?(t.Jr.Kr(e),Mh(t)):t.Jr.set("Unknown")}async function qh(t,e,n){if(t.Jr.set("Online"),e instanceof Ua&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const i of e.targetIds)t.Wr.has(i)&&(await t.remoteSyncer.rejectListen(i,n),t.Wr.delete(i),t.Yr.removeTarget(i))}(t,e)}catch(n){nr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Bh(t,n)}else if(e instanceof Fa?t.Yr.ot(e):e instanceof Va?t.Yr.dt(e):t.Yr.ut(e),!n.isEqual(Ar.min()))try{const e=await Zc(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Yr.gt(e);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.Wr.get(i);s&&t.Wr.set(i,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.Wr.get(e);if(!n)return;t.Wr.set(e,n.withResumeToken(Or.EMPTY_BYTE_STRING,n.snapshotVersion)),Oh(t,e);const i=new Uc(n.target,e,1,n.sequenceNumber);xh(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){nr("RemoteStore","Failed to raise snapshot:",e),await Bh(t,e)}}async function Bh(t,e,n){if(!Pc(e))throw e;t.Gr.add(1),await Nh(t),t.Jr.set("Offline"),n||(n=()=>Zc(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{nr("RemoteStore","Retrying IndexedDB access"),await n(),t.Gr.delete(1),await _h(t)}))}function $h(t,e){return e().catch((n=>Bh(t,n,e)))}async function Kh(t){const e=cr(t),n=tu(e);let i=e.Qr.length>0?e.Qr[e.Qr.length-1].batchId:-1;for(;Hh(e);)try{const t=await th(e.localStore,i);if(null===t){0===e.Qr.length&&n._r();break}i=t.batchId,zh(e,t)}catch(t){await Bh(e,t)}Gh(e)&&Wh(e)}function Hh(t){return Fh(t)&&t.Qr.length<10}function zh(t,e){t.Qr.push(e);const n=tu(t);n.lr()&&n.Sr&&n.Dr(e.mutations)}function Gh(t){return Fh(t)&&!tu(t).hr()&&t.Qr.length>0}function Wh(t){tu(t).start()}async function Qh(t){tu(t).kr()}async function Xh(t){const e=tu(t);for(const n of t.Qr)e.Dr(n.mutations)}async function Yh(t,e,n){const i=t.Qr.shift(),s=Vc.from(i,e,n);await $h(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await Kh(t)}async function Jh(t,e){e&&tu(t).Sr&&await async function(t,e){if(function(t){switch(t){default:return or();case hr.CANCELLED:case hr.UNKNOWN:case hr.DEADLINE_EXCEEDED:case hr.RESOURCE_EXHAUSTED:case hr.INTERNAL:case hr.UNAVAILABLE:case hr.UNAUTHENTICATED:return!1;case hr.INVALID_ARGUMENT:case hr.NOT_FOUND:case hr.ALREADY_EXISTS:case hr.PERMISSION_DENIED:case hr.FAILED_PRECONDITION:case hr.ABORTED:case hr.OUT_OF_RANGE:case hr.UNIMPLEMENTED:case hr.DATA_LOSS:return!0}}(n=e.code)&&n!==hr.ABORTED){const n=t.Qr.shift();tu(t).wr(),await $h(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Kh(t)}var n}(t,e),Gh(t)&&Wh(t)}function Zh(t){return t.Xr||(t.Xr=function(t,e,n){const i=cr(t);return i.Fr(),new Sh(e,i.ir,i.authCredentials,i.appCheckCredentials,i.k,n)}(t.datastore,t.asyncQueue,{Di:Uh.bind(null,t),Ni:jh.bind(null,t),Pr:qh.bind(null,t)}),t.zr.push((async e=>{e?(t.Xr.wr(),Ph(t)?Mh(t):t.Jr.set("Unknown")):(await t.Xr.stop(),Vh(t))}))),t.Xr}function tu(t){return t.Zr||(t.Zr=function(t,e,n){const i=cr(t);return i.Fr(),new Ah(e,i.ir,i.authCredentials,i.appCheckCredentials,i.k,n)}(t.datastore,t.asyncQueue,{Di:Qh.bind(null,t),Ni:Jh.bind(null,t),Nr:Xh.bind(null,t),Cr:Yh.bind(null,t)}),t.zr.push((async e=>{e?(t.Zr.wr(),await Kh(t)):(await t.Zr.stop(),t.Qr.length>0&&(nr("RemoteStore",`Stopping write stream with ${t.Qr.length} pending writes`),t.Qr=[]))}))),t.Zr}class eu{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new lr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,i,s){const r=Date.now()+n,o=new eu(t,e,r,i,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ur(hr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function nu(t,e){if(ir("AsyncQueue",`${e}: ${t}`),Pc(t))return new ur(hr.UNAVAILABLE,`${e}: ${t}`);throw t}class iu{constructor(t){this.comparator=t?(e,n)=>t(e,n)||Kr.comparator(e.key,n.key):(t,e)=>Kr.comparator(t.key,e.key),this.keyedMap=_a(),this.sortedSet=new ba(this.comparator)}static emptySet(t){return new iu(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof iu))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(!t.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new iu;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class su{constructor(){this.eo=new ba(Kr.comparator)}track(t){const e=t.doc.key,n=this.eo.get(e);n?0!==t.type&&3===n.type?this.eo=this.eo.insert(e,t):3===t.type&&1!==n.type?this.eo=this.eo.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.eo=this.eo.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.eo=this.eo.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.eo=this.eo.remove(e):1===t.type&&2===n.type?this.eo=this.eo.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.eo=this.eo.insert(e,{type:2,doc:t.doc}):or():this.eo=this.eo.insert(e,t)}no(){const t=[];return this.eo.inorderTraversal(((e,n)=>{t.push(n)})),t}}class ru{constructor(t,e,n,i,s,r,o,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(t,e,n,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new ru(t,e,iu.emptySet(e),s,n,i,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Oo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class ou{constructor(){this.so=void 0,this.listeners=[]}}class au{constructor(){this.queries=new Gc((t=>Mo(t)),Oo),this.onlineState="Unknown",this.io=new Set}}function cu(t,e){const n=cr(t);let i=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.listeners)e.oo(t)&&(i=!0);s.so=t}}i&&uu(n)}function hu(t,e,n){const i=cr(t),s=i.queries.get(e);if(s)for(const t of s.listeners)t.onError(n);i.queries.delete(e)}function uu(t){t.io.forEach((t=>{t.next()}))}class lu{constructor(t,e,n){this.query=t,this.ao=e,this.co=!1,this.uo=null,this.onlineState="Unknown",this.options=n||{}}oo(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new ru(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.co?this.ho(t)&&(this.ao.next(t),e=!0):this.lo(t,this.onlineState)&&(this.fo(t),e=!0),this.uo=t,e}onError(t){this.ao.error(t)}ro(t){this.onlineState=t;let e=!1;return this.uo&&!this.co&&this.lo(this.uo,t)&&(this.fo(this.uo),e=!0),e}lo(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.wo&&n||t.docs.isEmpty()&&"Offline"!==e)}ho(t){if(t.docChanges.length>0)return!0;const e=this.uo&&this.uo.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}fo(t){t=ru.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.co=!0,this.ao.next(t)}}class du{constructor(t){this.key=t}}class fu{constructor(t){this.key=t}}class pu{constructor(t,e){this.query=t,this.To=e,this.Eo=null,this.current=!1,this.Io=La(),this.mutatedKeys=La(),this.Ao=Vo(t),this.Ro=new iu(this.Ao)}get Po(){return this.To}bo(t,e){const n=e?e.vo:new su,i=e?e.Ro:this.Ro;let s=e?e.mutatedKeys:this.mutatedKeys,r=i,o=!1;const a=No(this.query)&&i.size===this.query.limit?i.last():null,c=Ro(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(((t,e)=>{const h=i.get(t),u=Fo(this.query,e)?e:null,l=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;h&&u?h.data.isEqual(u.data)?l!==d&&(n.track({type:3,doc:u}),f=!0):this.Vo(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.Ao(u,a)>0||c&&this.Ao(u,c)<0)&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||c)&&(o=!0)),f&&(u?(r=r.add(u),s=d?s.add(t):s.delete(t)):(r=r.delete(t),s=s.delete(t)))})),No(this.query)||Ro(this.query))for(;r.size>this.query.limit;){const t=No(this.query)?r.last():r.first();r=r.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{Ro:r,vo:n,Bn:o,mutatedKeys:s}}Vo(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const i=this.Ro;this.Ro=t.Ro,this.mutatedKeys=t.mutatedKeys;const s=t.vo.no();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return or()}};return n(t)-n(e)}(t.type,e.type)||this.Ao(t.doc,e.doc))),this.So(n);const r=e?this.Do():[],o=0===this.Io.size&&this.current?1:0,a=o!==this.Eo;return this.Eo=o,0!==s.length||a?{snapshot:new ru(this.query,t.Ro,i,s,t.mutatedKeys,0===o,a,!1),Co:r}:{Co:r}}ro(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new su,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(t){return!this.To.has(t)&&!!this.Ro.has(t)&&!this.Ro.get(t).hasLocalMutations}So(t){t&&(t.addedDocuments.forEach((t=>this.To=this.To.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.To=this.To.delete(t))),this.current=t.current)}Do(){if(!this.current)return[];const t=this.Io;this.Io=La(),this.Ro.forEach((t=>{this.No(t.key)&&(this.Io=this.Io.add(t.key))}));const e=[];return t.forEach((t=>{this.Io.has(t)||e.push(new fu(t))})),this.Io.forEach((n=>{t.has(n)||e.push(new du(n))})),e}ko(t){this.To=t.zn,this.Io=La();const e=this.bo(t.documents);return this.applyChanges(e,!0)}xo(){return ru.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class gu{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class mu{constructor(t){this.key=t,this.$o=!1}}class yu{constructor(t,e,n,i,s,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.Fo={},this.Oo=new Gc((t=>Mo(t)),Oo),this.Mo=new Map,this.Lo=new Set,this.Bo=new ba(Kr.comparator),this.Uo=new Map,this.qo=new sh,this.Ko={},this.jo=new Map,this.Qo=Hc.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}async function vu(t,e){const n=function(t){const e=cr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Eu.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ou.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Tu.bind(null,e),e.Fo.Pr=cu.bind(null,e.eventManager),e.Fo.zo=hu.bind(null,e.eventManager),e}(t);let i,s;const r=n.Oo.get(e);if(r)i=r.targetId,n.sharedClientState.addLocalQueryTarget(i),s=r.view.xo();else{const t=await function(t,e){const n=cr(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let i;return n.He.getTargetData(t,e).next((s=>s?(i=s,Mc.resolve(i)):n.He.allocateTargetId(t).next((s=>(i=new Uc(e,s,0,t.currentSequenceNumber),n.He.addTargetData(t,i).next((()=>i)))))))})).then((t=>{const i=n.qn.get(t.targetId);return(null===i||t.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.qn=n.qn.insert(t.targetId,t),n.Kn.set(e,t.targetId)),t}))}(n.localStore,xo(e)),r=n.sharedClientState.addLocalQueryTarget(t.targetId);i=t.targetId,s=await async function(t,e,n,i){t.Go=(e,n,i)=>async function(t,e,n,i){let s=e.view.bo(n);s.Bn&&(s=await nh(t.localStore,e.query,!1).then((({documents:t})=>e.view.bo(t,s))));const r=i&&i.targetChanges.get(e.targetId),o=e.view.applyChanges(s,t.isPrimaryClient,r);return _u(t,e.targetId,o.Co),o.snapshot}(t,e,n,i);const s=await nh(t.localStore,e,!0),r=new pu(e,s.zn),o=r.bo(s.documents),a=Pa.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==t.onlineState),c=r.applyChanges(o,t.isPrimaryClient,a);_u(t,n,c.Co);const h=new gu(e,n,r);return t.Oo.set(e,h),t.Mo.has(n)?t.Mo.get(n).push(e):t.Mo.set(n,[e]),c.snapshot}(n,e,i,"current"===r),n.isPrimaryClient&&Rh(n.remoteStore,t)}return s}async function wu(t,e){const n=cr(t),i=n.Oo.get(e),s=n.Mo.get(i.targetId);if(s.length>1)return n.Mo.set(i.targetId,s.filter((t=>!Oo(t,e)))),void n.Oo.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await eh(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),Lh(n.remoteStore,i.targetId),Du(n,i.targetId)})).catch(zc)):(Du(n,i.targetId),await eh(n.localStore,i.targetId,!0))}async function Eu(t,e){const n=cr(t);try{const t=await function(t,e){const n=cr(t),i=e.snapshotVersion;let s=n.qn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.Qn.newChangeBuffer({trackRemovals:!0});s=n.qn;const o=[];e.targetChanges.forEach(((e,r)=>{const a=s.get(r);if(!a)return;o.push(n.He.removeMatchingKeys(t,e.removedDocuments,r).next((()=>n.He.addMatchingKeys(t,e.addedDocuments,r))));const c=e.resumeToken;if(c.approximateByteSize()>0){const h=a.withResumeToken(c,i).withSequenceNumber(t.currentSequenceNumber);s=s.insert(r,h),function(t,e,n){return ar(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,h,e)&&o.push(n.He.updateTargetData(t,h))}}));let a=Da();if(e.documentUpdates.forEach(((i,s)=>{e.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,i))})),o.push(function(t,e,n,i,s){let r=La();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=Da();return n.forEach(((n,o)=>{const a=t.get(n),c=(null==s?void 0:s.get(n))||i;o.isNoDocument()&&o.version.isEqual(Ar.min())?(e.removeEntry(n,c),r=r.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(o,c),r=r.insert(n,o)):nr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)})),r}))}(t,r,e.documentUpdates,i,void 0).next((t=>{a=t}))),!i.isEqual(Ar.min())){const e=n.He.getLastRemoteSnapshotVersion(t).next((e=>n.He.setTargetsMetadata(t,t.currentSequenceNumber,i)));o.push(e)}return Mc.waitFor(o).next((()=>r.apply(t))).next((()=>n.Wn.Vn(t,a))).next((()=>a))})).then((t=>(n.qn=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const i=n.Uo.get(e);i&&(ar(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?i.$o=!0:t.modifiedDocuments.size>0?ar(i.$o):t.removedDocuments.size>0&&(ar(i.$o),i.$o=!1))})),await Lu(n,t,e)}catch(t){await zc(t)}}function bu(t,e,n){const i=cr(t);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const t=[];i.Oo.forEach(((n,i)=>{const s=i.view.ro(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=cr(t);n.onlineState=e;let i=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.ro(e)&&(i=!0)})),i&&uu(n)}(i.eventManager,e),t.length&&i.Fo.Pr(t),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function Tu(t,e,n){const i=cr(t);i.sharedClientState.updateQueryState(e,"rejected",n);const s=i.Uo.get(e),r=s&&s.key;if(r){let t=new ba(Kr.comparator);t=t.insert(r,oo.newNoDocument(r,Ar.min()));const n=La().add(r),s=new Ma(Ar.min(),new Map,new Sa(Tr),t,n);await Eu(i,s),i.Bo=i.Bo.remove(r),i.Uo.delete(e),Ru(i)}else await eh(i.localStore,e,!1).then((()=>Du(i,e,n))).catch(zc)}async function Iu(t,e){const n=cr(t),i=e.batch.batchId;try{const t=await function(t,e){const n=cr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const i=e.batch.keys(),s=n.Qn.newChangeBuffer({trackRemovals:!0});return function(t,e,n,i){const s=n.batch,r=s.keys();let o=Mc.resolve();return r.forEach((t=>{o=o.next((()=>i.getEntry(e,t))).next((e=>{const r=n.docVersions.get(t);ar(null!==r),e.version.compareTo(r)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&i.addEntry(e,n.commitVersion))}))})),o.next((()=>t.An.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n.An.performConsistencyCheck(t))).next((()=>n.Wn.vn(t,i)))}))}(n.localStore,e);Cu(n,i,null),Au(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await Lu(n,t)}catch(t){await zc(t)}}async function Su(t,e,n){const i=cr(t);try{const t=await function(t,e){const n=cr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let i;return n.An.lookupMutationBatch(t,e).next((e=>(ar(null!==e),i=e.keys(),n.An.removeMutationBatch(t,e)))).next((()=>n.An.performConsistencyCheck(t))).next((()=>n.Wn.vn(t,i)))}))}(i.localStore,e);Cu(i,e,n),Au(i,e),i.sharedClientState.updateMutationState(e,"rejected",n),await Lu(i,t)}catch(n){await zc(n)}}function Au(t,e){(t.jo.get(e)||[]).forEach((t=>{t.resolve()})),t.jo.delete(e)}function Cu(t,e,n){const i=cr(t);let s=i.Ko[i.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),i.Ko[i.currentUser.toKey()]=s}}function Du(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const i of t.Mo.get(e))t.Oo.delete(i),n&&t.Fo.zo(i,n);t.Mo.delete(e),t.isPrimaryClient&&t.qo.us(e).forEach((e=>{t.qo.containsKey(e)||ku(t,e)}))}function ku(t,e){t.Lo.delete(e.path.canonicalString());const n=t.Bo.get(e);null!==n&&(Lh(t.remoteStore,n),t.Bo=t.Bo.remove(e),t.Uo.delete(n),Ru(t))}function _u(t,e,n){for(const i of n)i instanceof du?(t.qo.addReference(i.key,e),Nu(t,i)):i instanceof fu?(nr("SyncEngine","Document no longer in limbo: "+i.key),t.qo.removeReference(i.key,e),t.qo.containsKey(i.key)||ku(t,i.key)):or()}function Nu(t,e){const n=e.key,i=n.path.canonicalString();t.Bo.get(n)||t.Lo.has(i)||(nr("SyncEngine","New document in limbo: "+n),t.Lo.add(i),Ru(t))}function Ru(t){for(;t.Lo.size>0&&t.Bo.size<t.maxConcurrentLimboResolutions;){const e=t.Lo.values().next().value;t.Lo.delete(e);const n=new Kr(Nr.fromString(e)),i=t.Qo.next();t.Uo.set(i,new mu(n)),t.Bo=t.Bo.insert(n,i),Rh(t.remoteStore,new Uc(xo(_o(n.path)),i,2,wr.I))}}async function Lu(t,e,n){const i=cr(t),s=[],r=[],o=[];i.Oo.isEmpty()||(i.Oo.forEach(((t,a)=>{o.push(i.Go(a,e,n).then((t=>{if(t){i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),s.push(t);const e=Qc.$n(a.targetId,t);r.push(e)}})))})),await Promise.all(o),i.Fo.Pr(s),await async function(t,e){const n=cr(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Mc.forEach(e,(e=>Mc.forEach(e.kn,(i=>n.persistence.referenceDelegate.addReference(t,e.targetId,i))).next((()=>Mc.forEach(e.xn,(i=>n.persistence.referenceDelegate.removeReference(t,e.targetId,i)))))))))}catch(t){if(!Pc(t))throw t;nr("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.qn.get(e),i=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(i);n.qn=n.qn.insert(e,s)}}}(i.localStore,r))}async function xu(t,e){const n=cr(t);if(!n.currentUser.isEqual(e)){nr("SyncEngine","User change. New user:",e.toKey());const t=await Jc(n.localStore,e);n.currentUser=e,function(t,e){t.jo.forEach((t=>{t.forEach((t=>{t.reject(new ur(hr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.jo.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Lu(n,t.Gn)}}function Ou(t,e){const n=cr(t),i=n.Uo.get(e);if(i&&i.$o)return La().add(i.key);{let t=La();const i=n.Mo.get(e);if(!i)return t;for(const e of i){const i=n.Oo.get(e);t=t.unionWith(i.view.Po)}return t}}function Mu(t){const e=cr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Iu.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Su.bind(null,e),e}class Pu{constructor(){this.synchronizeTabs=!1}async initialize(t){this.k=bh(t.databaseInfo.databaseId),this.sharedClientState=this.Jo(t),this.persistence=this.Yo(t),await this.persistence.start(),this.gcScheduler=this.Xo(t),this.localStore=this.Zo(t)}Xo(t){return null}Zo(t){return function(t,e,n,i){return new Yc(t,e,n,i)}(this.persistence,new Xc,t.initialUser,this.k)}Yo(t){return new uh(dh.ks,this.k)}Jo(t){return new ph}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Fu{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>bu(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=xu.bind(null,this.syncEngine),await async function(t,e){const n=cr(t);e?(n.Gr.delete(2),await _h(n)):e||(n.Gr.add(2),await Nh(n),n.Jr.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new au}createDatastore(t){const e=bh(t.databaseInfo.databaseId),n=(i=t.databaseInfo,new wh(i));var i;return function(t,e,n,i){return new Ch(t,e,n,i)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,i=t.asyncQueue,s=t=>bu(this.syncEngine,t,0),r=mh.bt()?new mh:new gh,new kh(e,n,i,s,r);var e,n,i,s,r}createSyncEngine(t,e){return function(t,e,n,i,s,r,o){const a=new yu(t,e,n,i,s,r);return o&&(a.Wo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=cr(t);nr("RemoteStore","RemoteStore shutting down."),e.Gr.add(5),await Nh(e),e.Hr.shutdown(),e.Jr.set("Unknown")}(this.remoteStore)}}class Vu{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.ea(this.observer.next,t)}error(t){this.observer.error?this.ea(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}na(){this.muted=!0}ea(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Uu{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=Js.UNAUTHENTICATED,this.clientId=br.A(),this.authCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{nr("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(()=>Promise.resolve()))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new ur(hr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new lr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=nu(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function ju(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){return t.offlineComponents||(nr("FirestoreClient","Using default OfflineComponentProvider"),await async function(t,e){t.asyncQueue.verifyOperationInProgress(),nr("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener((async t=>{i.isEqual(t)||(await Jc(e.localStore,t),i=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}(t,new Pu)),t.offlineComponents}(t);nr("FirestoreClient","Initializing OnlineComponentProvider");const i=await t.getConfiguration();await e.initialize(n,i),t.setCredentialChangeListener((t=>async function(t,e){const n=cr(t);n.asyncQueue.verifyOperationInProgress(),nr("RemoteStore","RemoteStore received new credentials");const i=Fh(n);n.Gr.add(3),await Nh(n),i&&n.Jr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Gr.delete(3),await _h(n)}(e.remoteStore,t))),t.onlineComponents=e}async function qu(t){return t.onlineComponents||(nr("FirestoreClient","Using default OnlineComponentProvider"),await ju(t,new Fu)),t.onlineComponents}async function Bu(t){const e=await qu(t),n=e.eventManager;return n.onListen=vu.bind(null,e.syncEngine),n.onUnlisten=wu.bind(null,e.syncEngine),n}function $u(t,e,n={}){const i=new lr;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,i,s){const r=new Vu({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=cr(t),i=e.query;let s=!1;const r=n.queries.get(i);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),s=0===r.listeners.length)}if(s)return n.queries.delete(i),n.onUnlisten(i)}(t,o))),n.fromCache&&"server"===i.source?s.reject(new ur(hr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new lu(n,r,{includeMetadataChanges:!0,wo:!0});return async function(t,e){const n=cr(t),i=e.query;let s=!1,r=n.queries.get(i);if(r||(s=!0,r=new ou),s)try{r.so=await n.onListen(i)}catch(t){const n=nu(t,`Initialization of query '${Po(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,r),r.listeners.push(e),e.ro(n.onlineState),r.so&&e.oo(r.so)&&uu(n)}(t,o)}(await Bu(t),t.asyncQueue,e,n,i))),i.promise}class Ku{constructor(t,e,n,i,s,r,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Hu{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Hu&&t.projectId===this.projectId&&t.database===this.database}}const zu=new Map;function Gu(t,e,n){if(!n)throw new ur(hr.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Wu(t){if(!Kr.isDocumentKey(t))throw new ur(hr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Qu(t){if(Kr.isDocumentKey(t))throw new ur(hr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Xu(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":or()}function Yu(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ur(hr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Xu(t);throw new ur(hr.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Ju{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new ur(hr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ur(hr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(t,e,n,i){if(!0===e&&!0===i)throw new ur(hr.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Zu{constructor(t,e,n){this._authCredentials=e,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ju({}),this._settingsFrozen=!1,t instanceof Hu?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new ur(hr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Hu(t.options.projectId)}(t))}get app(){if(!this._app)throw new ur(hr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new ur(hr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ju(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new fr;switch(t.type){case"gapi":const e=t.client;return ar(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new mr(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new ur(hr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=zu.get(t);e&&(nr("ComponentProvider","Removing Datastore"),zu.delete(t),e.terminate())}(this),Promise.resolve()}}class tl{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new nl(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new tl(this.firestore,t,this._key)}}class el{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new el(this.firestore,t,this._query)}}class nl extends el{constructor(t,e,n){super(t,e,_o(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new tl(this.firestore,null,new Kr(t))}withConverter(t){return new nl(this.firestore,t,this._path)}}class il{constructor(){this.ma=Promise.resolve(),this.ga=[],this.ya=!1,this.pa=[],this.Ta=null,this.Ea=!1,this.Ia=!1,this.Aa=[],this.ur=new Th(this,"async_queue_retry"),this.Ra=()=>{const t=Eh();t&&nr("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ur.er()};const t=Eh();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ra)}get isShuttingDown(){return this.ya}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Pa(),this.ba(t)}enterRestrictedMode(t){if(!this.ya){this.ya=!0,this.Ia=t||!1;const e=Eh();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ra)}}enqueue(t){if(this.Pa(),this.ya)return new Promise((()=>{}));const e=new lr;return this.ba((()=>this.ya&&this.Ia?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.ga.push(t),this.va())))}async va(){if(0!==this.ga.length){try{await this.ga[0](),this.ga.shift(),this.ur.reset()}catch(t){if(!Pc(t))throw t;nr("AsyncQueue","Operation failed with retryable error: "+t)}this.ga.length>0&&this.ur.Zi((()=>this.va()))}}ba(t){const e=this.ma.then((()=>(this.Ea=!0,t().catch((t=>{this.Ta=t,this.Ea=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw ir("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Ea=!1,t))))));return this.ma=e,e}enqueueAfterDelay(t,e,n){this.Pa(),this.Aa.indexOf(t)>-1&&(e=0);const i=eu.createAndSchedule(this,t,e,n,(t=>this.Va(t)));return this.pa.push(i),i}Pa(){this.Ta&&or()}verifyOperationInProgress(){}async Sa(){let t;do{t=this.ma,await t}while(t!==this.ma)}Da(t){for(const e of this.pa)if(e.timerId===t)return!0;return!1}Ca(t){return this.Sa().then((()=>{this.pa.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.pa)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Sa()}))}Na(t){this.Aa.push(t)}Va(t){const e=this.pa.indexOf(t);this.pa.splice(e,1)}}class sl extends Zu{constructor(t,e,n){super(t,e,n),this.type="firestore",this._queue=new il,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||ol(this),this._firestoreClient.terminate()}}function rl(t){return t._firestoreClient||ol(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function ol(t){var e;const n=t._freezeSettings(),i=function(t,e,n,i){return new Ku(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Uu(t._authCredentials,t._appCheckCredentials,t._queue,i)}class al{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new ur(hr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Lr(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class cl{constructor(t){this._byteString=t}static fromBase64String(t){try{return new cl(Or.fromBase64String(t))}catch(t){throw new ur(hr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new cl(Or.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class hl{constructor(t){this._methodName=t}}class ul{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new ur(hr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new ur(hr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Tr(this._lat,t._lat)||Tr(this._long,t._long)}}const ll=/^__.*__$/;class dl{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new la(t,this.data,this.fieldMask,e,this.fieldTransforms):new ua(t,this.data,e,this.fieldTransforms)}}function fl(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw or()}}class pl{constructor(t,e,n,i,s,r){this.settings=t,this.databaseId=e,this.k=n,this.ignoreUndefinedProperties=i,void 0===s&&this.ka(),this.fieldTransforms=s||[],this.fieldMask=r||[]}get path(){return this.settings.path}get xa(){return this.settings.xa}$a(t){return new pl(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Fa(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.$a({path:n,Oa:!1});return i.Ma(t),i}La(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.$a({path:n,Oa:!1});return i.ka(),i}Ba(t){return this.$a({path:void 0,Oa:!0})}Ua(t){return Al(t,this.settings.methodName,this.settings.qa||!1,this.path,this.settings.Ka)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}ka(){if(this.path)for(let t=0;t<this.path.length;t++)this.Ma(this.path.get(t))}Ma(t){if(0===t.length)throw this.Ua("Document fields must not be empty");if(fl(this.xa)&&ll.test(t))throw this.Ua('Document fields cannot begin and end with "__"')}}class gl{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.k=n||bh(t)}ja(t,e,n,i=!1){return new pl({xa:t,methodName:e,Ka:n,path:Lr.emptyPath(),Oa:!1,qa:i},this.databaseId,this.k,this.ignoreUndefinedProperties)}}function ml(t){const e=t._freezeSettings(),n=bh(t._databaseId);return new gl(t._databaseId,!!e.ignoreUndefinedProperties,n)}function yl(t,e,n,i,s,r={}){const o=t.ja(r.merge||r.mergeFields?2:0,e,n,s);bl("Data must be an object, but it was:",o,i);const a=wl(i,o);let c,h;if(r.merge)c=new xr(o.fieldMask),h=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const i of r.mergeFields){const s=Tl(e,i,n);if(!o.contains(s))throw new ur(hr.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Cl(t,s)||t.push(s)}c=new xr(t),h=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,h=o.fieldTransforms;return new dl(new so(a),c,h)}function vl(t,e){if(El(t=u(t)))return bl("Unsupported field value:",e,t),wl(t,e);if(t instanceof hl)return function(t,e){if(!fl(e.xa))throw e.Ua(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Ua(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Oa&&4!==e.xa)throw e.Ua("Nested arrays are not supported");return function(t,e){const n=[];let i=0;for(const s of t){let t=vl(s,e.Ba(i));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),i++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=u(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Bo(e.k,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Sr.fromDate(t);return{timestampValue:Ga(e.k,n)}}if(t instanceof Sr){const n=new Sr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Ga(e.k,n)}}if(t instanceof ul)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof cl)return{bytesValue:Wa(e.k,t._byteString)};if(t instanceof tl){const n=e.databaseId,i=t.firestore._databaseId;if(!i.isEqual(n))throw e.Ua(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Ya(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Ua(`Unsupported field value: ${Xu(t)}`)}(t,e)}function wl(t,e){const n={};return kr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Dr(t,((t,i)=>{const s=vl(i,e.Fa(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function El(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Sr||t instanceof ul||t instanceof cl||t instanceof tl||t instanceof hl)}function bl(t,e,n){if(!El(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const i=Xu(n);throw"an object"===i?e.Ua(t+" a custom object"):e.Ua(t+" "+i)}}function Tl(t,e,n){if((e=u(e))instanceof al)return e._internalPath;if("string"==typeof e)return Sl(t,e);throw Al("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}const Il=new RegExp("[~\\*/\\[\\]]");function Sl(t,e,n){if(e.search(Il)>=0)throw Al(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new al(...e.split("."))._internalPath}catch(i){throw Al(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Al(t,e,n,i,s){const r=i&&!i.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${i}`),o&&(c+=` in document ${s}`),c+=")"),new ur(hr.INVALID_ARGUMENT,a+t+c)}function Cl(t,e){return t.some((t=>t.isEqual(e)))}class Dl{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new tl(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new kl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(_l("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class kl extends Dl{data(){return super.data()}}function _l(t,e){return"string"==typeof e?Sl(t,e):e instanceof al?e._internalPath:e._delegate._internalPath}class Nl{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Rl extends Dl{constructor(t,e,n,i,s,r){super(t,e,n,i,r),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Ll(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(_l("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Ll extends Rl{data(t={}){return super.data(t)}}class xl{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new Nl(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Ll(this._firestore,this._userDataWriter,n.key,n,new Nl(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new ur(hr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new Ll(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Nl(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const i=new Ll(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Nl(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,r=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:Ol(e.type),doc:i,oldIndex:s,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Ol(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return or()}}class Ml extends class{convertValue(t,e="none"){switch(Hr(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Fr(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Vr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw or()}}convertObject(t,e){const n={};return Dr(t.fields,((t,i)=>{n[t]=this.convertValue(i,e)})),n}convertGeoPoint(t){return new ul(Fr(t.latitude),Fr(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=jr(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(qr(t));default:return null}}convertTimestamp(t){const e=Pr(t);return new Sr(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=Nr.fromString(t);ar(vc(n));const i=new Hu(n.get(1),n.get(3)),s=new Kr(n.popFirst(5));return i.isEqual(e)||ir(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}{constructor(t){super(),this.firestore=t}convertBytes(t){return new cl(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new tl(this.firestore,null,e)}}function Pl(t,e){return function(t,e){const n=new lr;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const i=Mu(t);try{const t=await function(t,e){const n=cr(t),i=Sr.now(),s=e.reduce(((t,e)=>t.add(e.key)),La());let r;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>n.Wn.vn(t,s).next((s=>{r=s;const o=[];for(const t of e){const e=aa(t,r.get(t.key));null!=e&&o.push(new la(t.key,e,ro(e.value.mapValue),na.exists(!0)))}return n.An.addMutationBatch(t,i,o,e)})))).then((t=>(t.applyToLocalDocumentSet(r),{batchId:t.batchId,changes:r})))}(i.localStore,e);i.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let i=t.Ko[t.currentUser.toKey()];i||(i=new ba(Tr)),i=i.insert(e,n),t.Ko[t.currentUser.toKey()]=i}(i,t.batchId,n),await Lu(i,t.changes),await Kh(i.remoteStore)}catch(t){const e=nu(t,"Failed to persist write");n.reject(e)}}(await function(t){return qu(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(rl(t),e)}!function(t,e=!0){Zs="9.6.1",R(new l("firestore",((t,{options:n})=>{const i=t.getProvider("app").getImmediate(),s=new sl(i,new pr(t.getProvider("auth-internal")),new vr(t.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:e},n),s._setSettings(n),s}),"PUBLIC")),P(Ys,"3.4.1",t),P(Ys,"3.4.1","esm2017")}();const Fl=function(t,e={}){"object"!=typeof e&&(e={name:e});const n=Object.assign({name:"[DEFAULT]",automaticDataCollectionEnabled:!1},e),i=n.name;if("string"!=typeof i||!i)throw x.create("bad-app-name",{appName:String(i)});const s=k.get(i);if(s){if(a(t,s.options)&&a(n,s.config))return s;throw x.create("duplicate-app",{appName:i})}const r=new p(i);for(const t of _.values())r.addComponent(t);const o=new O(t,n,r);return k.set(i,o),o}({apiKey:"AIzaSyBWpUvYwDZN1xni1kIsVmUgK1H3N4-zjiA",authDomain:"charicha-league.firebaseapp.com",projectId:"charicha-league",storageBucket:"charicha-league.appspot.com",messagingSenderId:"264110155134",appId:"1:264110155134:web:ecdebc234615316f8f7f2f",measurementId:"G-HXJ2TT239N"}),Vl=(function(t=M()){const e=L(t=u(t),vt);e.isInitialized()?e.getImmediate():function(t,e={}){const n=L(t,vt);if(n.isInitialized()){const t=n.getImmediate();if(a(e,n.getOptions()))return t;throw Tt.create("already-initialized")}n.initialize({options:e})}(t)}(Fl),function(t=M()){return L(t,"firestore").getImmediate()}(Fl));async function Ul(){const t=function(t,e,...n){if(t=u(t),Gu("collection","path",e),t instanceof Zu){const i=Nr.fromString(e,...n);return Qu(i),new nl(t,null,i)}{if(!(t instanceof tl||t instanceof nl))throw new ur(hr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(Nr.fromString(e,...n));return Qu(i),new nl(t.firestore,null,i)}}(Vl,"leagues"),e=await function(t){t=Yu(t,el);const e=Yu(t.firestore,sl),n=rl(e),i=new Ml(e);return function(t){if(Ro(t)&&0===t.explicitOrderBy.length)throw new ur(hr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),$u(n,t._query).then((n=>new xl(e,i,t,n)))}(t),n=e.docs.map((t=>t.data()));for(var i=0;i<n.length;i++){var s=n[i].fixtures,r=[];for(var o in s)r.push(n[i].fixtures[o]);n[i].fixtures=r}return n}async function jl(t){for(var e={},n=0;n<t.fixtures.length;n++)e[""+n]=t.fixtures[n];await function(t,e,n){t=Yu(t,tl);const i=Yu(t.firestore,sl),s=function(t,e,n){let i;return i=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,i}(t.converter,e,n);return Pl(i,[yl(ml(i),"setDoc",t._key,s,null!==t.converter,n).toMutation(t._key,na.none())])}(function(t,e,...n){if(t=u(t),1===arguments.length&&(e=br.A()),Gu("doc","path",e),t instanceof Zu){const i=Nr.fromString(e,...n);return Wu(i),new tl(t,null,new Kr(i))}{if(!(t instanceof tl||t instanceof nl))throw new ur(hr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(Nr.fromString(e,...n));return Wu(i),new tl(t.firestore,t instanceof nl?t.converter:null,new Kr(i))}}(Vl,"leagues",t.title),{title:t.title,description:t.description,members:t.members,fixtures:e})}function ql(t,e){for(var n=function(t){for(var e=[],n=0;n<t.length;n++){for(var i=t[n],s=[],r=0;r<t.length;r++)r!=n&&s.push({home:i,away:t[r],is_played:!1,home_goals:[],away_goals:[]});e.push(s)}return e}(t),i=n.length*n[0].length,s=Math.ceil(i/e),r=[],o=0,a=-1,c=0,h=0;h<n.length;h++)for(var u=0;u<n[h].length;u++){0==o&&(r.push([]),a++);var l=c%n[h].length,d=c%n.length;r[a].push(n[d][l]),r[a].length==s?o=0:o++,c++}return r}window.onload=()=>{createLeagueButton.addEventListener("click",(e=>{e.preventDefault();for(var n=[],i=0;i<t;i++)n.push(document.getElementById("playerInputField"+i).value);var s=function(t,e,n,i=4){return{title:t,description:e,members:n,fixtures:ql(n,i)}}(leagueTitle.value,leagueDesc.value,n,totalFixtures.value);jl(s)}));var t=0;function e(t,e){var i=document.createElement("div");i.style.cssText="display: flex; flex-wrap: wrap";for(var s=0;s<t.fixtures.length;s++){var r=document.createElement("div");n(t.fixtures[s],"Fixture Week "+(s+1),r),i.appendChild(r)}e.appendChild(i)}function n(t,e="Fixture",n){var i=document.createElement("b");i.innerHTML=e;var s=document.createElement("table");s.appendChild(i),s.border="1px",s.style="margin: 20px; border: 2px solid; min-width: 400px";for(var r=0;r<t.length;r++){var o=document.createElement("tr");s.appendChild(o);var a=document.createElement("td"),c=document.createElement("td");o.appendChild(a),o.appendChild(c),o.style.cssText="display: flex; justify-content: space-between;",a.style.cssText="display: flex; justify-content: space-between",c.style.cssText="display: flex; justify-content: space-between";var h=document.createElement("p");h.innerHTML=t[r].home;var u=document.createElement("input");u.setAttribute("type","number");var l=document.createElement("p");l.innerHTML=t[r].away;var d=document.createElement("input");d.setAttribute("type","number"),t[r].is_played?(o.style.cssText="background-color: green",u.value=t[r].home_goals.length,d.value=t[r].away_goals.length):o.style.cssText="background-color: gray",a.appendChild(h),a.appendChild(u),c.appendChild(l),c.appendChild(d)}n.appendChild(s)}function i(t){t.preventDefault(),console.log(t.target)}totalPlayers.addEventListener("change",(e=>{e.preventDefault();for(var n=t;n<totalPlayers.value;n++){var i=document.createElement("div");i.setAttribute("id","playerDiv"+n);var s=document.createElement("input"),r=document.createElement("label");s.setAttribute("id","playerInputField"+n),r.setAttribute("for","playerInputField"+n),r.innerHTML="Player "+(n+1),i.appendChild(r),i.appendChild(s),endOfFields.before(i),t++}for(;t>totalPlayers.value;)t--,document.getElementById("playerDiv"+t).remove()})),async function(){var t=await Ul();console.log(t);for(var n=0;n<t.length;n++){var s=document.createElement("div");s.setAttribute("id","League"+n);var r=document.createElement("h2");r.innerHTML="League: "+t[n].title,s.appendChild(r),e(t[n],s),s.addEventListener("change",i),allLeagues.appendChild(s)}}()}})()})();